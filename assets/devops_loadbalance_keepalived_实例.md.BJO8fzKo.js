import{_ as s,c as a,o as n,a4 as l}from"./chunks/framework.GYzjcnJh.js";const u=JSON.parse('{"title":"Keepalived 单主架构","description":"","frontmatter":{"date":"2024-03-25 20:33:33"},"headers":[],"relativePath":"devops/loadbalance/keepalived/实例.md","filePath":"devops/loadbalance/keepalived/实例.md"}'),e={name:"devops/loadbalance/keepalived/实例.md"},p=l(`<h1 id="keepalived-单主架构" tabindex="-1">Keepalived 单主架构 <a class="header-anchor" href="#keepalived-单主架构" aria-label="Permalink to &quot;Keepalived 单主架构&quot;">​</a></h1><h2 id="master配置" tabindex="-1">MASTER配置 <a class="header-anchor" href="#master配置" aria-label="Permalink to &quot;MASTER配置&quot;">​</a></h2><p><code>/etc/keepalived/keepalived.conf</code></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">global_defs</span><span style="color:#91B859;"> {</span></span>
<span class="line"><span style="color:#E2931D;">    notification_email</span><span style="color:#91B859;"> {</span></span>
<span class="line"><span style="color:#E2931D;">        root@localhost</span><span style="color:#90A4AE;font-style:italic;"> #keepalived 发生故障切换时邮件发送的对象，可以按行区分写多个</span></span>
<span class="line"><span style="color:#90A4AE;">    }</span></span>
<span class="line"><span style="color:#E2931D;">    notification_email_from</span><span style="color:#91B859;"> keepalived@localhost</span></span>
<span class="line"><span style="color:#E2931D;">    smtp_server</span><span style="color:#F76D47;"> 127.0.0.1</span></span>
<span class="line"><span style="color:#E2931D;">    smtp_connect_timeout</span><span style="color:#F76D47;"> 30</span></span>
<span class="line"><span style="color:#E2931D;">    router_id</span><span style="color:#91B859;"> ka1.example.com</span></span>
<span class="line"><span style="color:#E2931D;">    vrrp_skip_check_adv_addr</span><span style="color:#90A4AE;font-style:italic;"> #所有报文都检查比较消耗性能，此配置为如果收到的报文和上一个报文是同一个路由器则跳过检查报文中的源地址</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;">#vrrp_strict #严格遵守VRRP协议,禁止状况:1.无VIP地址,2.配置了单播邻居,3.在VRRP版本2中有IPv6地址</span></span>
<span class="line"><span style="color:#E2931D;">    vrrp_garp_interval</span><span style="color:#F76D47;"> 0</span><span style="color:#90A4AE;font-style:italic;"> #ARP报文发送延迟</span></span>
<span class="line"><span style="color:#E2931D;">    vrrp_gna_interval</span><span style="color:#F76D47;"> 0</span><span style="color:#90A4AE;font-style:italic;"> #消息发送延迟</span></span>
<span class="line"><span style="color:#E2931D;">    vrrp_mcast_group4</span><span style="color:#F76D47;"> 224.0.0.18</span><span style="color:#90A4AE;font-style:italic;"> #默认组播IP地址，可指定组播范围：224.0.0.0到</span></span>
<span class="line"><span style="color:#E2931D;">    239.255.255.255</span></span>
<span class="line"><span style="color:#90A4AE;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">vrrp_instance</span><span style="color:#91B859;"> VI_1</span><span style="color:#91B859;"> {</span></span>
<span class="line"><span style="color:#E2931D;">    state</span><span style="color:#91B859;"> MASTER</span><span style="color:#90A4AE;font-style:italic;"> #在另一个结点上为BACKUP</span></span>
<span class="line"><span style="color:#E2931D;">    interface</span><span style="color:#91B859;"> eth0</span></span>
<span class="line"><span style="color:#E2931D;">    virtual_router_id</span><span style="color:#F76D47;"> 66</span><span style="color:#90A4AE;font-style:italic;"> #每个虚拟路由器必须唯一，同属一个虚拟路由器的多个keepalived节点必须相同</span></span>
<span class="line"><span style="color:#E2931D;">    priority</span><span style="color:#F76D47;"> 100</span><span style="color:#90A4AE;font-style:italic;"> #在另一个结点上为80</span></span>
<span class="line"><span style="color:#E2931D;">    advert_int</span><span style="color:#F76D47;"> 1</span></span>
<span class="line"><span style="color:#E2931D;">    authentication</span><span style="color:#91B859;"> {</span></span>
<span class="line"><span style="color:#E2931D;">        auth_type</span><span style="color:#91B859;"> PASS</span><span style="color:#90A4AE;font-style:italic;"> #预共享密钥认证，同一个虚拟路由器的keepalived节点必须一样</span></span>
<span class="line"><span style="color:#E2931D;">        auth_pass</span><span style="color:#F76D47;"> 12345678</span></span>
<span class="line"><span style="color:#90A4AE;">    }</span></span>
<span class="line"><span style="color:#E2931D;">    virtual_ipaddress</span><span style="color:#91B859;"> {</span></span>
<span class="line"><span style="color:#E2931D;">    10.0.0.10</span><span style="color:#91B859;"> dev</span><span style="color:#91B859;"> eth0</span><span style="color:#91B859;"> label</span><span style="color:#91B859;"> eth0:0</span></span>
<span class="line"><span style="color:#90A4AE;">    }</span></span>
<span class="line"><span style="color:#90A4AE;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><h2 id="backup配置" tabindex="-1">BACKUP配置 <a class="header-anchor" href="#backup配置" aria-label="Permalink to &quot;BACKUP配置&quot;">​</a></h2><p>配置文件和master基本一致，只需修改三行</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">router_id</span><span style="color:#91B859;"> ka2.example.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">state</span><span style="color:#91B859;"> BACKUP</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">priority</span><span style="color:#F76D47;"> 80</span><span style="color:#90A4AE;font-style:italic;"> #修改此行</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>`,7),o=[p];function r(c,t,i,b,y,d){return n(),a("div",null,o)}const _=s(e,[["render",r]]);export{u as __pageData,_ as default};
