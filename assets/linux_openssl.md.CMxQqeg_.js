import{_ as s,c as n,o as a,a4 as l}from"./chunks/framework.GYzjcnJh.js";const A=JSON.parse('{"title":"openssl","description":"","frontmatter":{"date":"2024-03-15 18:12:37"},"headers":[],"relativePath":"linux/openssl.md","filePath":"linux/openssl.md"}'),p={name:"linux/openssl.md"},e=l(`<h1 id="openssl" tabindex="-1">openssl <a class="header-anchor" href="#openssl" aria-label="Permalink to &quot;openssl&quot;">​</a></h1><p><strong>三个组件:</strong></p><ul><li><code>libcrypto</code>：用于实现加密和解密的库</li><li><code>libssl</code>：用于实现ssl通信协议的安全库</li><li><code>openssl</code>：多用途命令行工具</li></ul><h2 id="实现私有ca和证书申请" tabindex="-1">实现私有CA和证书申请 <a class="header-anchor" href="#实现私有ca和证书申请" aria-label="Permalink to &quot;实现私有CA和证书申请&quot;">​</a></h2><ol><li>生成证书申请请求</li><li>RA核验</li><li>CA签署</li><li>获取证书</li></ol><p><code>openssl</code>的配置文件: <code>/etc/pki/tls/openssl.cnf</code></p><p><strong>三种策略:</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">match：要求申请填写的信息跟CA设置信息必须一致</span></span>
<span class="line"><span style="color:#E2931D;">optional：可有可无，跟CA设置信息可不一致</span></span>
<span class="line"><span style="color:#E2931D;">supplied：必须填写这项申请信息</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>1. 创建CA所需要的文件</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">mkdir</span><span style="color:#91B859;"> -p</span><span style="color:#91B859;"> /etc/pki/CA/{certs,crl,newcerts,private}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;">#生成证书索引数据库文件</span></span>
<span class="line"><span style="color:#E2931D;">touch</span><span style="color:#91B859;"> /etc/pki/CA/index.txt</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;">#指定第一个颁发证书的序列号</span></span>
<span class="line"><span style="color:#6182B8;">echo</span><span style="color:#F76D47;"> 01</span><span style="color:#39ADB5;"> &gt;</span><span style="color:#91B859;"> /etc/pki/CA/serial</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">2.</span><span style="color:#91B859;"> 创建CA的私钥</span></span>
<span class="line"><span style="color:#6182B8;">cd</span><span style="color:#91B859;"> /etc/pki/CA/</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># umask 066 # 新版本不用设置权限</span></span>
<span class="line"><span style="color:#E2931D;">openssl</span><span style="color:#91B859;"> genrsa</span><span style="color:#91B859;"> -out</span><span style="color:#91B859;"> private/cakey.pem</span><span style="color:#90A4AE;font-style:italic;"> #  2048(默认值，可不写)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">3.</span><span style="color:#91B859;"> 给CA颁发自签名证书</span></span>
<span class="line"><span style="color:#E2931D;">openssl</span><span style="color:#91B859;"> req</span><span style="color:#91B859;"> -new</span><span style="color:#91B859;"> -x509</span><span style="color:#91B859;"> -key</span><span style="color:#91B859;"> /etc/pki/CA/private/cakey.pem</span><span style="color:#91B859;"> -days</span><span style="color:#F76D47;"> 3650</span><span style="color:#91B859;"> -out</span><span style="color:#91B859;"> /etc/pki/CA/cacert.pem</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 说明</span></span>
<span class="line"><span style="color:#E2931D;">-new：生成新证书签署请求</span></span>
<span class="line"><span style="color:#E2931D;">-x509：专用于CA生成自签证书</span></span>
<span class="line"><span style="color:#E2931D;">-key：生成请求时用到的私钥文件</span></span>
<span class="line"><span style="color:#E2931D;">-days</span><span style="color:#91B859;"> n：证书的有效期限</span></span>
<span class="line"><span style="color:#E2931D;">-out</span><span style="color:#91B859;"> /PATH/TO/SOMECERTFILE:</span><span style="color:#91B859;"> 证书的保存路径</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><hr><h2 id="方式二" tabindex="-1">方式二 <a class="header-anchor" href="#方式二" aria-label="Permalink to &quot;方式二&quot;">​</a></h2><h3 id="创建ca" tabindex="-1">创建CA <a class="header-anchor" href="#创建ca" aria-label="Permalink to &quot;创建CA&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#90A4AE;">domain</span><span style="color:#39ADB5;">=</span><span style="color:#91B859;">test.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 生成 CA 证书私钥</span></span>
<span class="line"><span style="color:#E2931D;">openssl</span><span style="color:#91B859;"> genrsa</span><span style="color:#91B859;"> -out</span><span style="color:#91B859;"> ca.key</span><span style="color:#F76D47;"> 4096</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 生成 CA 证书</span></span>
<span class="line"><span style="color:#E2931D;">openssl</span><span style="color:#91B859;"> req</span><span style="color:#91B859;"> -x509</span><span style="color:#91B859;"> -new</span><span style="color:#91B859;"> -nodes</span><span style="color:#91B859;"> -sha512</span><span style="color:#91B859;"> -days</span><span style="color:#F76D47;"> 3650</span><span style="color:#90A4AE;"> \\</span></span>
<span class="line"><span style="color:#91B859;"> -subj</span><span style="color:#39ADB5;"> &quot;</span><span style="color:#91B859;">/C=CN/ST=Beijing/L=Beijing/O=example/OU=dev/CN=</span><span style="color:#39ADB5;">\${</span><span style="color:#90A4AE;">domain</span><span style="color:#39ADB5;">}&quot;</span><span style="color:#90A4AE;"> \\</span></span>
<span class="line"><span style="color:#91B859;"> -key</span><span style="color:#91B859;"> ca.key</span><span style="color:#90A4AE;"> \\</span></span>
<span class="line"><span style="color:#91B859;"> -out</span><span style="color:#91B859;"> ca.crt</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="签发证书" tabindex="-1">签发证书 <a class="header-anchor" href="#签发证书" aria-label="Permalink to &quot;签发证书&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#90A4AE;font-style:italic;"> # 1 生成私钥</span></span>
<span class="line"><span style="color:#E2931D;"> openssl</span><span style="color:#91B859;"> genrsa</span><span style="color:#91B859;"> -out</span><span style="color:#39ADB5;"> \${</span><span style="color:#90A4AE;">domain</span><span style="color:#39ADB5;">}</span><span style="color:#91B859;">.key</span><span style="color:#F76D47;"> 4096</span></span>
<span class="line"><span style="color:#90A4AE;"> </span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"> # 2 生成证书签名请求 (CSR)</span></span>
<span class="line"><span style="color:#E2931D;"> openssl</span><span style="color:#91B859;"> req</span><span style="color:#91B859;"> -sha512</span><span style="color:#91B859;"> -new</span><span style="color:#91B859;"> -key</span><span style="color:#39ADB5;"> \${</span><span style="color:#90A4AE;">domain</span><span style="color:#39ADB5;">}</span><span style="color:#91B859;">.key</span><span style="color:#91B859;"> -out</span><span style="color:#39ADB5;"> \${</span><span style="color:#90A4AE;">domain</span><span style="color:#39ADB5;">}</span><span style="color:#91B859;">.csr</span><span style="color:#90A4AE;"> \\</span></span>
<span class="line"><span style="color:#91B859;">    -subj</span><span style="color:#39ADB5;"> &quot;</span><span style="color:#91B859;">/C=CN/ST=Chengdu/L=Chengdu/O=test/OU=dev/CN=</span><span style="color:#39ADB5;">\${</span><span style="color:#90A4AE;">domain</span><span style="color:#39ADB5;">}&quot;</span></span>
<span class="line"><span style="color:#90A4AE;">    </span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 3 使用ca签发证书</span></span>
<span class="line"><span style="color:#E2931D;">openssl</span><span style="color:#91B859;"> x509</span><span style="color:#91B859;"> -req</span><span style="color:#91B859;"> -sha512</span><span style="color:#91B859;"> -days</span><span style="color:#F76D47;"> 3650</span><span style="color:#90A4AE;"> \\</span></span>
<span class="line"><span style="color:#91B859;">    -CA</span><span style="color:#91B859;"> ca.crt</span><span style="color:#91B859;"> -CAkey</span><span style="color:#91B859;"> ca.key</span><span style="color:#91B859;"> -CAcreateserial</span><span style="color:#90A4AE;"> \\</span></span>
<span class="line"><span style="color:#91B859;">    -in</span><span style="color:#39ADB5;"> \${</span><span style="color:#90A4AE;">domain</span><span style="color:#39ADB5;">}</span><span style="color:#91B859;">.csr</span><span style="color:#90A4AE;"> \\</span></span>
<span class="line"><span style="color:#91B859;">    -out</span><span style="color:#39ADB5;"> \${</span><span style="color:#90A4AE;">domain</span><span style="color:#39ADB5;">}</span><span style="color:#91B859;">.crt</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>2</p>`,17),o=[e];function c(r,t,i,y,b,u){return a(),n("div",null,o)}const m=s(p,[["render",c]]);export{A as __pageData,m as default};
