import{_ as s,c as a,o as e,a4 as n}from"./chunks/framework.GYzjcnJh.js";const y=JSON.parse('{"title":"主从复制","description":"","frontmatter":{"date":"2024-03-01 15:16:14"},"headers":[],"relativePath":"db/redis/master_slave.md","filePath":"backend/db/redis/master_slave.md"}'),l={name:"db/redis/master_slave.md"},p=n(`<h1 id="主从复制" tabindex="-1">主从复制 <a class="header-anchor" href="#主从复制" aria-label="Permalink to &quot;主从复制&quot;">​</a></h1><p>当master出现故障后,可以会提升一个slave节点变成新的Mster,因此Redis Slave 需要设置和master相同 的连接密码，此外当一个Slave提升为新的master 通过持久化实现数据的恢复</p><p><strong>主从复制特点：</strong></p><ul><li>一个master可以有多个slave</li><li>一个slave只能有一个master</li><li>数据流向是从master到slave单向的</li><li>master 可读可写</li><li>slave 只读</li></ul><h2 id="启用主从同步" tabindex="-1">启用主从同步 <a class="header-anchor" href="#启用主从同步" aria-label="Permalink to &quot;启用主从同步&quot;">​</a></h2><p>Redis Server 默认为 master节点，如果要配置为从节点,需要指定<code>master</code>服务器的IP，端口及连接密码</p><p><strong>临时修改</strong></p><p>从服务器执行</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">127.0.0.1:6379</span><span style="color:#90A4AE;">&gt; </span><span style="color:#91B859;">REPLICAOF</span><span style="color:#91B859;"> MASTER_IP</span><span style="color:#91B859;"> PORT</span><span style="color:#90A4AE;font-style:italic;"> #新版推荐使用</span></span>
<span class="line"><span style="color:#E2931D;">127.0.0.1:6379</span><span style="color:#90A4AE;">&gt; </span><span style="color:#91B859;">CONFIG</span><span style="color:#91B859;"> SET</span><span style="color:#91B859;"> masterauth</span><span style="color:#39ADB5;"> &lt;</span><span style="color:#91B859;">masterpas</span><span style="color:#90A4AE;">s</span><span style="color:#39ADB5;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;">#127.0.0.1:6379&gt; SLAVEOF MasterIP Port #旧版使用，将被淘汰</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>配置文件更改</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#90A4AE;font-style:italic;"># vim redis.conf</span></span>
<span class="line"><span style="color:#E2931D;">replicaof</span><span style="color:#91B859;"> masterip</span><span style="color:#91B859;"> port</span><span style="color:#90A4AE;"> </span></span>
<span class="line"><span style="color:#E2931D;">masterauth</span><span style="color:#91B859;"> password</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="删除主从同步" tabindex="-1">删除主从同步 <a class="header-anchor" href="#删除主从同步" aria-label="Permalink to &quot;删除主从同步&quot;">​</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#90A4AE;font-style:italic;">#取消复制,在slave上执行REPLICAOF NO ONE,会断开和master的连接不再主从复制, 但不会清除slave上已有的数据</span></span>
<span class="line"><span style="color:#E2931D;">127.0.0.1:6379</span><span style="color:#90A4AE;">&gt; </span><span style="color:#91B859;">REPLICAOF</span><span style="color:#91B859;"> no</span><span style="color:#91B859;"> one</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="判断主从连接的状态" tabindex="-1">判断主从连接的状态 <a class="header-anchor" href="#判断主从连接的状态" aria-label="Permalink to &quot;判断主从连接的状态&quot;">​</a></h2><p><code>master_link_status</code> 是up 还是down</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">redis-cli</span><span style="color:#91B859;"> info</span><span style="color:#91B859;"> replication</span><span style="color:#39ADB5;">|</span><span style="color:#E2931D;"> grep</span><span style="color:#91B859;"> master_link_status</span><span style="color:#39ADB5;">|</span><span style="color:#E2931D;">awk</span><span style="color:#91B859;"> -F:</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">{print $2}</span><span style="color:#39ADB5;">&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div>`,16),t=[p];function r(o,i,c,d,m,b){return e(),a("div",null,t)}const h=s(l,[["render",r]]);export{y as __pageData,h as default};
