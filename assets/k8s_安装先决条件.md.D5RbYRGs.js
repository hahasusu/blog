import{_ as s,c as n,o as e,a4 as a}from"./chunks/framework.GYzjcnJh.js";const y=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"k8s/安装先决条件.md","filePath":"k8s/安装先决条件.md"}'),l={name:"k8s/安装先决条件.md"},p=a(`<h2 id="转发-ipv4-并让-iptables-看到桥接流量" tabindex="-1">转发 IPv4 并让 iptables 看到桥接流量 <a class="header-anchor" href="#转发-ipv4-并让-iptables-看到桥接流量" aria-label="Permalink to &quot;转发 IPv4 并让 iptables 看到桥接流量&quot;">​</a></h2><p><a href="https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/#%E8%BD%AC%E5%8F%91-ipv4-%E5%B9%B6%E8%AE%A9-iptables-%E7%9C%8B%E5%88%B0%E6%A1%A5%E6%8E%A5%E6%B5%81%E9%87%8F" target="_blank" rel="noreferrer">https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/#转发-ipv4-并让-iptables-看到桥接流量</a></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">cat</span><span style="color:#39ADB5;"> &lt;&lt;</span><span style="color:#39ADB5;">EOF</span><span style="color:#39ADB5;"> |</span><span style="color:#E2931D;"> sudo</span><span style="color:#91B859;"> tee</span><span style="color:#91B859;"> /etc/modules-load.d/k8s.conf</span></span>
<span class="line"><span style="color:#91B859;">overlay</span></span>
<span class="line"><span style="color:#91B859;">br_netfilter</span></span>
<span class="line"><span style="color:#39ADB5;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">sudo</span><span style="color:#91B859;"> modprobe</span><span style="color:#91B859;"> overlay</span></span>
<span class="line"><span style="color:#E2931D;">sudo</span><span style="color:#91B859;"> modprobe</span><span style="color:#91B859;"> br_netfilter</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 设置所需的 sysctl 参数，参数在重新启动后保持不变</span></span>
<span class="line"><span style="color:#E2931D;">cat</span><span style="color:#39ADB5;"> &lt;&lt;</span><span style="color:#39ADB5;">EOF</span><span style="color:#39ADB5;"> |</span><span style="color:#E2931D;"> sudo</span><span style="color:#91B859;"> tee</span><span style="color:#91B859;"> /etc/sysctl.d/k8s.conf</span></span>
<span class="line"><span style="color:#91B859;">net.bridge.bridge-nf-call-iptables  = 1</span></span>
<span class="line"><span style="color:#91B859;">net.bridge.bridge-nf-call-ip6tables = 1</span></span>
<span class="line"><span style="color:#91B859;">net.ipv4.ip_forward                 = 1</span></span>
<span class="line"><span style="color:#39ADB5;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 应用 sysctl 参数而不重新启动</span></span>
<span class="line"><span style="color:#E2931D;">sudo</span><span style="color:#91B859;"> sysctl</span><span style="color:#91B859;"> --system</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>通过运行以下指令确认 <code>br_netfilter</code> 和 <code>overlay</code> 模块被加载：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">lsmod</span><span style="color:#39ADB5;"> |</span><span style="color:#E2931D;"> grep</span><span style="color:#91B859;"> br_netfilter</span></span>
<span class="line"><span style="color:#E2931D;">lsmod</span><span style="color:#39ADB5;"> |</span><span style="color:#E2931D;"> grep</span><span style="color:#91B859;"> overlay</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>通过运行以下指令确认 <code>net.bridge.bridge-nf-call-iptables</code>、<code>net.bridge.bridge-nf-call-ip6tables</code> 和 <code>net.ipv4.ip_forward</code> 系统变量在你的 <code>sysctl</code> 配置中被设置为 1：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">sysctl</span><span style="color:#91B859;"> net.bridge.bridge-nf-call-iptables</span><span style="color:#91B859;"> net.bridge.bridge-nf-call-ip6tables</span><span style="color:#91B859;"> net.ipv4.ip_forward</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="cgroup-驱动" tabindex="-1">cgroup 驱动 <a class="header-anchor" href="#cgroup-驱动" aria-label="Permalink to &quot;cgroup 驱动&quot;">​</a></h2><blockquote><p>从 v1.22 开始，在使用 kubeadm 创建集群时，如果用户没有在 <code>KubeletConfiguration</code> 下设置 <code>cgroupDriver</code> 字段，kubeadm 默认使用 <code>systemd</code>。</p></blockquote><p>要将 <code>systemd</code> 设置为 cgroup 驱动，需编辑 <a href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubelet-config-file/" target="_blank" rel="noreferrer"><code>KubeletConfiguration</code></a> 的 <code>cgroupDriver</code> 选项，并将其设置为 <code>systemd</code>。例如：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">apiVersion:</span><span style="color:#91B859;"> kubelet.config.k8s.io/v1beta1</span></span>
<span class="line"><span style="color:#E2931D;">kind:</span><span style="color:#91B859;"> KubeletConfiguration</span></span>
<span class="line"><span style="color:#6182B8;">...</span></span>
<span class="line"><span style="color:#E2931D;">cgroupDriver:</span><span style="color:#91B859;"> systemd</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="容器运行时" tabindex="-1">容器运行时 <a class="header-anchor" href="#容器运行时" aria-label="Permalink to &quot;容器运行时&quot;">​</a></h2><p>为了在 Pod 中运行容器，Kubernetes 使用 <a href="https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes" target="_blank" rel="noreferrer">容器运行时（Container Runtime）</a>。</p><p>默认情况下，Kubernetes 使用 <a href="https://kubernetes.io/zh-cn/docs/concepts/overview/components/#container-runtime" target="_blank" rel="noreferrer">容器运行时接口（Container Runtime Interface，CRI）</a> 来与你所选择的容器运行时交互。</p><p>如果你不指定运行时，kubeadm 会自动尝试通过扫描已知的端点列表来检测已安装的容器运行时。</p><p>如果检测到有多个或者没有容器运行时，kubeadm 将抛出一个错误并要求你指定一个想要使用的运行时。</p><table tabindex="0"><thead><tr><th>运行时</th><th>Unix 域套接字</th></tr></thead><tbody><tr><td>containerd</td><td><code>unix:///var/run/containerd/containerd.sock</code></td></tr><tr><td>CRI-O</td><td><code>unix:///var/run/crio/crio.sock</code></td></tr><tr><td>Docker Engine（使用 cri-dockerd）</td><td><code>unix:///var/run/cri-dockerd.sock</code></td></tr></tbody></table>`,17),r=[p];function o(t,c,i,d,b,u){return e(),n("div",null,r)}const h=s(l,[["render",o]]);export{y as __pageData,h as default};
