import{_ as s,c as n,o as a,a4 as l}from"./chunks/framework.GYzjcnJh.js";const d=JSON.parse('{"title":"","description":"","frontmatter":{"date":"2024-03-10 18:07:08"},"headers":[],"relativePath":"linux/lnmp.md","filePath":"linux/lnmp.md"}'),p={name:"linux/lnmp.md"},e=l(`<h2 id="_1-配置数据库" tabindex="-1">1 配置数据库 <a class="header-anchor" href="#_1-配置数据库" aria-label="Permalink to &quot;1 配置数据库&quot;">​</a></h2><ol><li><p>安装mysql</p></li><li><p>创建wordpress数据库和用户并授权</p></li></ol><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">mysql</span><span style="color:#91B859;"> -uroot</span><span style="color:#91B859;"> -p123456</span><span style="color:#39ADB5;"> &lt;&lt;</span><span style="color:#39ADB5;"> EOF</span></span>
<span class="line"><span style="color:#91B859;">create database wordpress;</span></span>
<span class="line"><span style="color:#91B859;">create user wordpress@&#39;10.0.0.%&#39; identified by &#39;123456&#39;;</span></span>
<span class="line"><span style="color:#91B859;">grant all on wordpress.* to wordpress@&#39;10.0.0.%&#39;;</span></span>
<span class="line"><span style="color:#39ADB5;">EOF</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="3"><li>在WordPress服务器使用授权的MySQL账户远程登录测试权限</li></ol><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">mysql</span><span style="color:#91B859;"> -uwordpress</span><span style="color:#91B859;"> -p123456</span><span style="color:#91B859;"> -h10.0.0.11</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="_2-部署php" tabindex="-1">2 部署PHP <a class="header-anchor" href="#_2-部署php" aria-label="Permalink to &quot;2 部署PHP&quot;">​</a></h2><ol><li>编译安装PHP</li></ol><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">dnf</span><span style="color:#91B859;"> -y</span><span style="color:#91B859;"> install</span><span style="color:#91B859;"> gcc</span><span style="color:#91B859;"> openssl-devel</span><span style="color:#91B859;"> libxml2-devel</span><span style="color:#91B859;"> bzip2-devel</span></span>
<span class="line"><span style="color:#E2931D;">libmcrypt-devel</span><span style="color:#91B859;"> sqlite-devel</span><span style="color:#91B859;"> oniguruma</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6182B8;">cd</span><span style="color:#91B859;"> /usr/local/src</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">wget</span><span style="color:#91B859;"> https://www.php.net/distributions/php-7.4.11.tar.xz</span></span>
<span class="line"><span style="color:#E2931D;">tar</span><span style="color:#91B859;"> xf</span><span style="color:#91B859;"> php-7.4.11.tar.xz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">./configure</span><span style="color:#91B859;"> --prefix=/apps/php74</span><span style="color:#91B859;"> --enable-mysqlnd</span><span style="color:#91B859;"> --with-mysqli=mysqlnd</span><span style="color:#90A4AE;"> \\</span></span>
<span class="line"><span style="color:#90A4AE;">--with-pdo-mysql=mysqlnd </span><span style="color:#91B859;">--with-openssl</span><span style="color:#91B859;"> --with-zlib</span><span style="color:#91B859;"> --with-config-file-path=/etc</span><span style="color:#90A4AE;"> \\</span></span>
<span class="line"><span style="color:#90A4AE;">--with-config-file-scan-dir=/etc/php.d </span><span style="color:#91B859;">--enable-mbstring</span><span style="color:#91B859;"> --enable-xml</span><span style="color:#91B859;"> --enable-sockets</span><span style="color:#90A4AE;"> \\</span></span>
<span class="line"><span style="color:#90A4AE;">--enable-fpm </span><span style="color:#91B859;">--enable-maintainer-zts</span><span style="color:#91B859;"> --disable-fileinfo</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">make</span><span style="color:#91B859;"> -j</span><span style="color:#F76D47;"> 4</span><span style="color:#39ADB5;"> &amp;&amp;</span><span style="color:#E2931D;"> make</span><span style="color:#91B859;"> install</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="2"><li>准备配置文件</li></ol><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#90A4AE;font-style:italic;">#生成配置文件</span></span>
<span class="line"><span style="color:#E2931D;">cp</span><span style="color:#91B859;"> /usr/local/src/php-7.4.11/php.ini-production</span><span style="color:#91B859;"> /etc/php.ini</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6182B8;">cd</span><span style="color:#91B859;"> /apps/php74/etc</span></span>
<span class="line"><span style="color:#E2931D;">cp</span><span style="color:#91B859;"> php-fpm.conf.default</span><span style="color:#91B859;"> php-fpm.conf</span></span>
<span class="line"><span style="color:#6182B8;">cd</span><span style="color:#91B859;"> php-fpm.d/</span></span>
<span class="line"><span style="color:#E2931D;">cp</span><span style="color:#91B859;"> www.conf.default</span><span style="color:#91B859;"> www.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">vim</span><span style="color:#91B859;"> www.conf</span></span>
<span class="line"><span style="color:#39ADB5;">[</span><span style="color:#90A4AE;">www</span><span style="color:#39ADB5;">]</span></span>
<span class="line"><span style="color:#E2931D;">user</span><span style="color:#91B859;"> =</span><span style="color:#91B859;"> www</span></span>
<span class="line"><span style="color:#E2931D;">group</span><span style="color:#91B859;"> =</span><span style="color:#91B859;"> www</span></span>
<span class="line"><span style="color:#E2931D;">listen</span><span style="color:#91B859;"> =</span><span style="color:#91B859;"> 127.0.0.1:9000</span></span>
<span class="line"><span style="color:#E2931D;">pm</span><span style="color:#91B859;"> =</span><span style="color:#91B859;"> dynamic</span></span>
<span class="line"><span style="color:#E2931D;">pm.max_children</span><span style="color:#91B859;"> =</span><span style="color:#F76D47;"> 5</span></span>
<span class="line"><span style="color:#E2931D;">pm.start_servers</span><span style="color:#91B859;"> =</span><span style="color:#F76D47;"> 2</span></span>
<span class="line"><span style="color:#E2931D;">pm.min_spare_servers</span><span style="color:#91B859;"> =</span><span style="color:#F76D47;"> 1</span></span>
<span class="line"><span style="color:#E2931D;">pm.max_spare_servers</span><span style="color:#91B859;"> =</span><span style="color:#F76D47;"> 3</span></span>
<span class="line"><span style="color:#E2931D;">pm.status_path</span><span style="color:#91B859;"> =</span><span style="color:#91B859;"> /pm_status</span></span>
<span class="line"><span style="color:#E2931D;">ping.path</span><span style="color:#91B859;"> =</span><span style="color:#91B859;"> /ping</span></span>
<span class="line"><span style="color:#E2931D;">access.log</span><span style="color:#91B859;"> =</span><span style="color:#91B859;"> log/</span><span style="color:#90A4AE;">$pool</span><span style="color:#91B859;">.access.log</span></span>
<span class="line"><span style="color:#E2931D;">slowlog</span><span style="color:#91B859;"> =</span><span style="color:#91B859;"> log/</span><span style="color:#90A4AE;">$pool</span><span style="color:#91B859;">.log.slowlog</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;">#创建用户</span></span>
<span class="line"><span style="color:#E2931D;">useradd</span><span style="color:#91B859;"> -r</span><span style="color:#91B859;"> -s</span><span style="color:#91B859;"> /sbin/nologin</span><span style="color:#91B859;"> www</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;">#创建访问日志文件路径</span></span>
<span class="line"><span style="color:#E2931D;">mkdir</span><span style="color:#91B859;"> /apps/php74/log</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><ol start="3"><li>启动并验证 php-fpm 服务</li></ol><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">/apps/php74/sbin/php-fpm</span><span style="color:#91B859;"> -t</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">cp</span><span style="color:#91B859;"> /usr/local/src/php-7.4.11/sapi/fpm/php-fpm.service</span><span style="color:#91B859;"> /usr/lib/systemd/system/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">systemctl</span><span style="color:#91B859;"> daemon-reload</span></span>
<span class="line"><span style="color:#E2931D;">systemctl</span><span style="color:#91B859;"> enable</span><span style="color:#91B859;"> --now</span><span style="color:#91B859;"> php-fpm</span></span>
<span class="line"><span style="color:#E2931D;">ss</span><span style="color:#91B859;"> -ntl</span></span>
<span class="line"><span style="color:#E2931D;">ps</span><span style="color:#91B859;"> -ef</span><span style="color:#39ADB5;"> |</span><span style="color:#E2931D;">grep</span><span style="color:#91B859;"> php</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="_3-部署nginx" tabindex="-1">3 部署nginx <a class="header-anchor" href="#_3-部署nginx" aria-label="Permalink to &quot;3 部署nginx&quot;">​</a></h2><ol><li><p>脚本安装 nginx</p></li><li><p>配置 Nginx 支持 fastcgi</p></li></ol><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">server</span><span style="color:#91B859;"> {</span></span>
<span class="line"><span style="color:#E2931D;">    listen</span><span style="color:#F76D47;"> 80</span><span style="color:#39ADB5;">;</span></span>
<span class="line"><span style="color:#E2931D;">    server_name</span><span style="color:#F76D47;"> 10.0.0.12</span><span style="color:#39ADB5;">;</span></span>
<span class="line"><span style="color:#E2931D;">    location</span><span style="color:#91B859;"> /</span><span style="color:#91B859;"> {</span></span>
<span class="line"><span style="color:#E2931D;">        root</span><span style="color:#91B859;"> /usr/local/nginx/wordpress</span><span style="color:#39ADB5;">;</span><span style="color:#90A4AE;font-style:italic;"> #指定数据目录</span></span>
<span class="line"><span style="color:#E2931D;">        index</span><span style="color:#91B859;"> index.php</span><span style="color:#91B859;"> index.html</span><span style="color:#91B859;"> index.htm</span><span style="color:#39ADB5;">;</span><span style="color:#90A4AE;font-style:italic;"> #指定默认主页</span></span>
<span class="line"><span style="color:#90A4AE;">    }</span></span>
<span class="line"><span style="color:#E2931D;">    error_page</span><span style="color:#F76D47;"> 500</span><span style="color:#F76D47;"> 502</span><span style="color:#F76D47;"> 503</span><span style="color:#F76D47;"> 504</span><span style="color:#91B859;"> /50x.html</span><span style="color:#39ADB5;">;</span></span>
<span class="line"><span style="color:#E2931D;">    location</span><span style="color:#91B859;"> =</span><span style="color:#91B859;"> /50x.html</span><span style="color:#91B859;"> {</span></span>
<span class="line"><span style="color:#E2931D;">        root</span><span style="color:#91B859;"> html</span><span style="color:#39ADB5;">;</span></span>
<span class="line"><span style="color:#90A4AE;">    }</span></span>
<span class="line"><span style="color:#E2931D;">    location</span><span style="color:#91B859;"> ~</span><span style="color:#90A4AE;"> \\.</span><span style="color:#91B859;">php</span><span style="color:#90A4AE;">$ </span><span style="color:#91B859;">{</span><span style="color:#90A4AE;font-style:italic;"> #实现php-fpm</span></span>
<span class="line"><span style="color:#E2931D;">        root</span><span style="color:#91B859;"> /usr/local/nginx/wordpress</span><span style="color:#39ADB5;">;</span></span>
<span class="line"><span style="color:#E2931D;">        fastcgi_pass</span><span style="color:#91B859;"> 127.0.0.1:9000</span><span style="color:#39ADB5;">;</span></span>
<span class="line"><span style="color:#E2931D;">        fastcgi_index</span><span style="color:#91B859;"> index.php</span><span style="color:#39ADB5;">;</span></span>
<span class="line"><span style="color:#E2931D;">        fastcgi_param</span><span style="color:#91B859;"> SCRIPT_FILENAME</span><span style="color:#90A4AE;"> $document_root$fastcgi_script_name</span><span style="color:#39ADB5;">;</span></span>
<span class="line"><span style="color:#E2931D;">        include</span><span style="color:#91B859;"> fastcgi_params</span><span style="color:#39ADB5;">;</span></span>
<span class="line"><span style="color:#90A4AE;">    }</span></span>
<span class="line"><span style="color:#E2931D;">    location</span><span style="color:#91B859;"> ~</span><span style="color:#91B859;"> ^/</span><span style="color:#39ADB5;">(</span><span style="color:#E2931D;">ping</span><span style="color:#39ADB5;">|</span><span style="color:#E2931D;">pm_status</span><span style="color:#39ADB5;">)</span><span style="color:#90A4AE;">$ </span><span style="color:#91B859;">{</span></span>
<span class="line"><span style="color:#E2931D;">        include</span><span style="color:#91B859;"> fastcgi_params</span><span style="color:#39ADB5;">;</span></span>
<span class="line"><span style="color:#E2931D;">        fastcgi_pass</span><span style="color:#91B859;"> 127.0.0.1:9000</span><span style="color:#39ADB5;">;</span></span>
<span class="line"><span style="color:#E2931D;">        fastcgi_param</span><span style="color:#91B859;"> SCRIPT_FILENAME</span><span style="color:#90A4AE;"> $document_root$fastcgi_script_name</span><span style="color:#39ADB5;">;</span></span>
<span class="line"><span style="color:#90A4AE;">    }</span></span>
<span class="line"><span style="color:#90A4AE;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><code>nginx -t</code> &amp;&amp; <code>nginx -s reload</code></p><p>3 准备 php 测试页</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">mkdir</span><span style="color:#91B859;"> -p</span><span style="color:#91B859;"> /usr/local/nginx/wordpress</span></span>
<span class="line"><span style="color:#6182B8;">echo</span><span style="color:#39ADB5;"> &quot;</span><span style="color:#91B859;">&lt;?php phpinfo(); ?&gt;</span><span style="color:#39ADB5;">&quot;</span><span style="color:#39ADB5;"> &gt;&gt;</span><span style="color:#91B859;"> /usr/local/nginx/wordpress/test.php</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 返回 pong</span></span>
<span class="line"><span style="color:#E2931D;">curl</span><span style="color:#91B859;"> 127.0.0.1/ping</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 或浏览器访问</span></span>
<span class="line"><span style="color:#E2931D;">server/test.php</span><span style="color:#90A4AE;"> </span></span>
<span class="line"><span style="color:#E2931D;">server/pm_status</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="_4-部署wordpress" tabindex="-1">4 部署wordpress <a class="header-anchor" href="#_4-部署wordpress" aria-label="Permalink to &quot;4 部署wordpress&quot;">​</a></h2><ol><li>准备 WordPress 文件</li></ol><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">wget</span><span style="color:#91B859;"> https://cn.wordpress.org/latest-zh_CN.tar.gz</span></span>
<span class="line"><span style="color:#E2931D;">tar</span><span style="color:#91B859;"> xf</span><span style="color:#91B859;"> latest-zh_CN.tar.gz</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">mv</span><span style="color:#91B859;"> wordpress/</span><span style="color:#90A4AE;">*</span><span style="color:#91B859;"> /usr/local/nginx/wordpress</span></span>
<span class="line"><span style="color:#E2931D;">chown</span><span style="color:#91B859;"> -R</span><span style="color:#91B859;"> www.www</span><span style="color:#91B859;"> /usr/local/nginx/wordpress/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="2"><li>打开浏览器配置</li></ol><h2 id="rhel8-oniguruma缺失" tabindex="-1">RHEL8 oniguruma缺失 <a class="header-anchor" href="#rhel8-oniguruma缺失" aria-label="Permalink to &quot;RHEL8 oniguruma缺失&quot;">​</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">wget</span><span style="color:#91B859;"> https://github.com/kkos/oniguruma/archive/v6.9.4.tar.gz</span><span style="color:#91B859;"> -O</span><span style="color:#91B859;"> oniguruma-6.9.4.tar.gz</span></span>
<span class="line"><span style="color:#E2931D;">tar</span><span style="color:#91B859;"> -zxvf</span><span style="color:#91B859;"> oniguruma-6.9.4.tar.gz</span></span>
<span class="line"><span style="color:#6182B8;">cd</span><span style="color:#91B859;"> oniguruma-6.9.4/</span></span>
<span class="line"><span style="color:#E2931D;">yum</span><span style="color:#91B859;"> install</span><span style="color:#91B859;"> autoconf</span><span style="color:#91B859;"> automake</span><span style="color:#91B859;"> libtool</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">./autogen.sh</span><span style="color:#39ADB5;"> &amp;&amp;</span><span style="color:#E2931D;"> ./configure</span><span style="color:#91B859;"> --prefix=/usr</span></span>
<span class="line"><span style="color:#E2931D;">make</span><span style="color:#39ADB5;"> &amp;&amp;</span><span style="color:#E2931D;"> make</span><span style="color:#91B859;"> install</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div>`,24),o=[e];function r(c,t,i,y,b,m){return a(),n("div",null,o)}const B=s(p,[["render",r]]);export{d as __pageData,B as default};
