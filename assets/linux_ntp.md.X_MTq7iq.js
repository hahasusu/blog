import{_ as s,c as n,o as a,a4 as e}from"./chunks/framework.GYzjcnJh.js";const u=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"linux/ntp.md","filePath":"linux/ntp.md"}'),l={name:"linux/ntp.md"},p=e(`<h2 id="linux-时间" tabindex="-1">linux 时间 <a class="header-anchor" href="#linux-时间" aria-label="Permalink to &quot;linux 时间&quot;">​</a></h2><ul><li>协调世界时「UTC - Coordinated Universal Time」</li><li>格林尼治标准时间「Greenwich Mean Time Zone」</li><li>中国标准时间「CST – China Standard Time」</li><li>RTC Real-Time Clock 硬件时间</li></ul><h2 id="timedatectl" tabindex="-1">timedatectl <a class="header-anchor" href="#timedatectl" aria-label="Permalink to &quot;timedatectl&quot;">​</a></h2><p>timedatectl 是 systemd-timedated.service 系统服务的命令行客户端，是在 RHEL7 及 CentOS7 中新增的 systemd 的一部分，用于系统时间管理。在 CentOS 7 系统上，建议使用 timedatectl 而不是 date、hwclock 命令来调整时间。在 Ubuntu 系统上，也采用 timedatectl 来管理时间，但是在 Ubuntu 系统上时间的管理流程稍有不同。</p><p>在最新的 Ubuntu 版本中，timedatectl 替代了老旧的 ntpdate。默认情况下，timedatectl 在系统启动的时候会立刻同步时间，并在稍后网络连接激活后通过 socket 再次检查一次。如果已安装了 ntpdate / ntp，timedatectl 会退而让你使用之前的设置。这样确保了两个时间同步服务不会相互冲突，同时在你升级的时候还保留原本的行为和配置。但这也意味着从旧版本的发行版升级时ntp/ntpdate 仍会安装，因此会导致新的基于 systemd 的时间服务被禁用。</p><p>在最新的 Ubuntu 版本中，timesyncd 替代了 ntpd 的客户端的部分。默认情况下 timesyncd 会定期检测并同步时间。它还会在本地存储更新的时间，以便在系统重启时做时间单步调整。通过 timedatectl 和 timesyncd 设置的当前时间状态和时间配置，可以使用 timedatectl status命令来进行确认。而在 CentOS 7 中，不存在 timesyncd 服务，是由 chrony 来作为 ntpd 的客户端的部分。</p><p><code>timedatectl</code> 能做到：修改系统时间、修改 RTC 时间、修改系统时区、设置 NTP 时间同步、查看当前系统时间状态。</p><p>一般来说使用 <code>timedatectl</code> 已经能满足日常对于时间操作的需求了。</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">timedatectl</span><span style="color:#91B859;"> show</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">修改系统时间</span></span>
<span class="line"><span style="color:#E2931D;">timedatectl</span><span style="color:#91B859;"> set-time</span><span style="color:#91B859;"> YYYY-MM-DD</span><span style="color:#91B859;"> HH:MM:SS</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">修改当前时区</span></span>
<span class="line"><span style="color:#E2931D;">timedatectl</span><span style="color:#91B859;"> set-timezone</span><span style="color:#91B859;"> TIMEZONE</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 关闭时间同步</span></span>
<span class="line"><span style="color:#E2931D;">timedatectl</span><span style="color:#91B859;"> set-ntp</span><span style="color:#F76D47;"> 1</span><span style="color:#90A4AE;font-style:italic;"> # 0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h2 id="chrony" tabindex="-1">chrony <a class="header-anchor" href="#chrony" aria-label="Permalink to &quot;chrony&quot;">​</a></h2><blockquote><p>在 Rocky Linux 中，通常使用 chrony 软件包来替代 NTP 来进行时间同步。</p></blockquote><blockquote><p>它不但可以提供保持系统时间与 NTP 时钟服务器同步的服务，还能作为 NTP 服务器对其他服务器提供时间同步服务</p></blockquote><p><strong>chrony 有两个核心组件</strong></p><ul><li><code>chronyd</code> 守护进程，主要用于调整内核中运行的系统时间和时间服务器同步</li><li><code>chronyc</code> 命令行界面程序，让用户能够对 chronyd 的性能进行监控以及改变各种参数</li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">dnf</span><span style="color:#91B859;"> install</span><span style="color:#91B859;"> chrony</span></span>
<span class="line"><span style="color:#E2931D;">systemctl</span><span style="color:#91B859;"> enable</span><span style="color:#91B859;"> --now</span><span style="color:#91B859;"> chronyd</span></span>
<span class="line"><span style="color:#E2931D;">systemctl</span><span style="color:#91B859;"> status</span><span style="color:#91B859;"> chronyd</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">显示所有</span><span style="color:#91B859;"> NTP</span><span style="color:#91B859;"> 源服务器的信息</span></span>
<span class="line"><span style="color:#E2931D;">chronyc</span><span style="color:#91B859;"> sources</span><span style="color:#91B859;"> -v</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">chronyc</span><span style="color:#91B859;"> -n</span><span style="color:#91B859;"> tracking</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 修改配置文件 </span></span>
<span class="line"><span style="color:#E2931D;">vim</span><span style="color:#91B859;"> /etc/chrony.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>如果您想使用 pool.ntp.org 项目中的公共 NTP 服务器，则最小的 chrony.conf 文件可以是</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#90A4AE;font-style:italic;"># pool pool.ntp.org iburst</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># iburst 选项表示在启动时快速同步时间</span></span>
<span class="line"><span style="color:#E2931D;">server</span><span style="color:#91B859;"> ntp1.aliyun.com</span><span style="color:#91B859;"> iburst</span></span>
<span class="line"><span style="color:#E2931D;">driftfile</span><span style="color:#91B859;"> /var/lib/chrony/drift</span></span>
<span class="line"><span style="color:#E2931D;">makestep</span><span style="color:#F76D47;"> 1</span><span style="color:#F76D47;"> 3</span></span>
<span class="line"><span style="color:#E2931D;">rtcsync</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div>`,17),t=[p];function c(o,r,i,d,b,m){return a(),n("div",null,t)}const h=s(l,[["render",c]]);export{u as __pageData,h as default};
