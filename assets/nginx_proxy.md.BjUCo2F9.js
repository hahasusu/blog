import{_ as s,c as n,o as a,a4 as l}from"./chunks/framework.GYzjcnJh.js";const u=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"nginx/proxy.md","filePath":"backend/nginx/proxy.md"}'),e={name:"nginx/proxy.md"},p=l(`<h2 id="_3-反向代理" tabindex="-1">3 反向代理 <a class="header-anchor" href="#_3-反向代理" aria-label="Permalink to &quot;3 反向代理&quot;">​</a></h2><blockquote><p>反向代理是一个Web服务器，它接受客户端的连接请求，然后将请求转发给上游服务器，并将从服务器得到的结果返回给连接的客户端。下面简单的反向代理的例子：</p></blockquote><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">server</span><span style="color:#91B859;"> {</span><span style="color:#90A4AE;">  </span></span>
<span class="line"><span style="color:#E2931D;">  listen</span><span style="color:#F76D47;">       80</span><span style="color:#39ADB5;">;</span><span style="color:#90A4AE;">                                                        </span></span>
<span class="line"><span style="color:#E2931D;">  server_name</span><span style="color:#91B859;">  localhost</span><span style="color:#39ADB5;">;</span><span style="color:#90A4AE;">                                              </span></span>
<span class="line"><span style="color:#E2931D;">  client_max_body_size</span><span style="color:#91B859;"> 1024M</span><span style="color:#39ADB5;">;</span><span style="color:#90A4AE;font-style:italic;">  # 允许客户端请求的最大单文件字节数</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">  location</span><span style="color:#91B859;"> /</span><span style="color:#91B859;"> {</span></span>
<span class="line"><span style="color:#E2931D;">    proxy_pass</span><span style="color:#91B859;">                         http://localhost:8080</span><span style="color:#39ADB5;">;</span></span>
<span class="line"><span style="color:#E2931D;">    proxy_set_header</span><span style="color:#91B859;"> Host</span><span style="color:#90A4AE;">              $host</span><span style="color:#91B859;">:</span><span style="color:#90A4AE;">$server_port</span><span style="color:#39ADB5;">;</span></span>
<span class="line"><span style="color:#E2931D;">    proxy_set_header</span><span style="color:#91B859;"> X-Forwarded-For</span><span style="color:#90A4AE;">   $remote_addr</span><span style="color:#39ADB5;">;</span><span style="color:#90A4AE;font-style:italic;"> # HTTP的请求端真实的IP</span></span>
<span class="line"><span style="color:#E2931D;">    proxy_set_header</span><span style="color:#91B859;"> X-Forwarded-Proto</span><span style="color:#90A4AE;"> $scheme</span><span style="color:#39ADB5;">;</span><span style="color:#90A4AE;font-style:italic;">      # 为了正确地识别实际用户发出的协议是 http 还是 https</span></span>
<span class="line"><span style="color:#90A4AE;">  }</span></span>
<span class="line"><span style="color:#90A4AE;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><code>Permission denied) while connecting to upstream</code></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">　1.临时关闭（不用重启机器）：</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;">##设置SELinux 成为permissive模式</span></span>
<span class="line"><span style="color:#E2931D;">setenforce</span><span style="color:#F76D47;"> 0</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;">#setenforce 1 设置SELinux 成为enforcing模式</span></span>
<span class="line"><span style="color:#E2931D;">2.修改配置文件需要重启机器：</span></span>
<span class="line"><span style="color:#E2931D;">修改/etc/selinux/config</span><span style="color:#91B859;"> 文件</span></span>
<span class="line"><span style="color:#E2931D;">/etc/sysconfig/selinux</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">将SELINUX</span><span style="color:#91B859;">=enforcing改为SELINUX=disabled</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">重启机器即可</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">setsebool</span><span style="color:#91B859;"> -P</span><span style="color:#91B859;"> httpd_can_network_connect</span><span style="color:#F76D47;"> 1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div>`,5),o=[p];function r(c,t,i,y,b,d){return a(),n("div",null,o)}const _=s(e,[["render",r]]);export{u as __pageData,_ as default};
