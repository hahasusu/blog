import{_ as s,c as a,o as n,a4 as l}from"./chunks/framework.GYzjcnJh.js";const d=JSON.parse('{"title":"介绍","description":"","frontmatter":{"date":"2024-03-27 13:39:56","outline":[1,2,3,4]},"headers":[],"relativePath":"other/gitlab.md","filePath":"other/gitlab.md"}'),p={name:"other/gitlab.md"},e=l(`<h1 id="介绍" tabindex="-1">介绍 <a class="header-anchor" href="#介绍" aria-label="Permalink to &quot;介绍&quot;">​</a></h1><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>GitLab是利用Ruby on Rails一个开源的版本管理系统，实现一个自托管的Git项目仓库，可通过Web界面进行访问公开的或者私人项目。</p><p>GitLab能够浏览源代码，管理缺陷和注释。可以管理团队对仓库的访问，它非常易于浏览提交过的版本并提供一个文件历史库。团队成员可以利用内置的简单聊天程序(Wall)进行交流。</p><p>它还提供一个代码片段收集功能可以轻松实现代码复用，便于日后有需要的时候进行查找</p></div><h2 id="gitlab服务构成" tabindex="-1">Gitlab服务构成 <a class="header-anchor" href="#gitlab服务构成" aria-label="Permalink to &quot;Gitlab服务构成&quot;">​</a></h2><ul><li>Nginx：静态web服务器。</li><li>gitlab-shell：用于处理Git命令和修改authorized keys列表。</li><li>gitlab-workhorse: 轻量级的反向代理服务器。</li><li>logrotate：日志文件管理工具。</li><li>postgresql：数据库。</li><li>redis：缓存数据库。</li><li>sidekiq：用于在后台执行队列任务（异步执行）。</li><li>unicorn：An HTTP server for Rack applications，GitLab Rails应用是托管在这个服务器上面的。</li></ul><h2 id="常用命令" tabindex="-1">常用命令 <a class="header-anchor" href="#常用命令" aria-label="Permalink to &quot;常用命令&quot;">​</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">gitlab-ctl</span><span style="color:#91B859;"> start</span><span style="color:#90A4AE;font-style:italic;">         # 启动所有 gitlab 组件</span></span>
<span class="line"><span style="color:#E2931D;">gitlab-ctl</span><span style="color:#91B859;"> stop</span><span style="color:#90A4AE;font-style:italic;">          # 停止所有 gitlab 组件</span></span>
<span class="line"><span style="color:#E2931D;">gitlab-ctl</span><span style="color:#91B859;"> restart</span><span style="color:#90A4AE;font-style:italic;">       # 重启所有 gitlab 组件</span></span>
<span class="line"><span style="color:#E2931D;">gitlab-ctl</span><span style="color:#91B859;"> status</span><span style="color:#90A4AE;font-style:italic;">        # 查看服务状态</span></span>
<span class="line"><span style="color:#90A4AE;"> </span></span>
<span class="line"><span style="color:#E2931D;">gitlab-ctl</span><span style="color:#91B859;"> reconfigure</span><span style="color:#90A4AE;font-style:italic;">   # 启动服务</span></span>
<span class="line"><span style="color:#E2931D;">gitlab-ctl</span><span style="color:#91B859;"> show-config</span><span style="color:#90A4AE;font-style:italic;">   # 验证配置文件</span></span>
<span class="line"><span style="color:#90A4AE;"> </span></span>
<span class="line"><span style="color:#E2931D;">gitlab-ctl</span><span style="color:#91B859;"> tail</span><span style="color:#90A4AE;font-style:italic;">          # 查看日志</span></span>
<span class="line"><span style="color:#90A4AE;"> </span></span>
<span class="line"><span style="color:#E2931D;">gitlab-rake</span><span style="color:#91B859;"> gitlab:check</span><span style="color:#91B859;"> SANITIZE=</span><span style="color:#39ADB5;">true</span><span style="color:#91B859;"> --trace</span><span style="color:#90A4AE;font-style:italic;">    # 检查gitlab</span></span>
<span class="line"><span style="color:#90A4AE;"> </span></span>
<span class="line"><span style="color:#E2931D;">vim</span><span style="color:#91B859;"> /etc/gitlab/gitlab.rb</span><span style="color:#90A4AE;font-style:italic;"> # 修改默认的配置文件</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h1 id="通过yum仓库安装" tabindex="-1">通过yum仓库安装 <a class="header-anchor" href="#通过yum仓库安装" aria-label="Permalink to &quot;通过yum仓库安装&quot;">​</a></h1><p><a href="https://packages.gitlab.com/gitlab/gitlab-ce/install#bash-rpm" target="_blank" rel="noreferrer">https://packages.gitlab.com/gitlab/gitlab-ce/install#bash-rpm</a></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#90A4AE;font-style:italic;"># 1. 安装依赖</span></span>
<span class="line"><span style="color:#E2931D;">dnf</span><span style="color:#91B859;"> install</span><span style="color:#91B859;"> -y</span><span style="color:#91B859;"> curl</span><span style="color:#91B859;"> policycoreutils</span><span style="color:#91B859;"> openssh-server</span><span style="color:#91B859;"> perl</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 2 添加Gitlab仓库</span></span>
<span class="line"><span style="color:#E2931D;">curl</span><span style="color:#91B859;"> https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.rpm.sh</span><span style="color:#39ADB5;"> |</span><span style="color:#E2931D;"> bash</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 3 查看可用的版本</span></span>
<span class="line"><span style="color:#E2931D;">dnf</span><span style="color:#91B859;"> list</span><span style="color:#91B859;"> gitlab-ce</span><span style="color:#91B859;"> --showduplicates</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 4 安装</span></span>
<span class="line"><span style="color:#E2931D;">dnf</span><span style="color:#91B859;"> install</span><span style="color:#91B859;"> gitlab-ce-16.8.0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="配置文件修改" tabindex="-1">配置文件修改 <a class="header-anchor" href="#配置文件修改" aria-label="Permalink to &quot;配置文件修改&quot;">​</a></h2><p>配置文件<code>/etc/gitlab/gitlab.rb</code> 3000行都是被注释的</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#90A4AE;font-style:italic;"># 从GitLab 12.9开始，Puma被引入作为Web服务器，以取代Unicorn。Puma支持多线程，相比Unicorn可以更有效地利用资源</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">cp</span><span style="color:#91B859;"> gitlab.rb</span><span style="color:#91B859;"> gitlab.rb.bak</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;">#external_url &#39;https://10.0.0.9:8888&#39;</span></span>
<span class="line"><span style="color:#E2931D;">external_url</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">https://gitlab.zbluo.com:8888</span><span style="color:#39ADB5;">&#39;</span></span>
<span class="line"><span style="color:#E2931D;">puma[</span><span style="color:#E2931D;">&#39;enable&#39;</span><span style="color:#E2931D;">]</span><span style="color:#91B859;"> =</span><span style="color:#39ADB5;"> true</span></span>
<span class="line"><span style="color:#E2931D;">unicorn[</span><span style="color:#E2931D;">&#39;enable&#39;</span><span style="color:#E2931D;">]</span><span style="color:#91B859;"> =</span><span style="color:#39ADB5;"> false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">puma[</span><span style="color:#E2931D;">&#39;worker_processes&#39;</span><span style="color:#E2931D;">]</span><span style="color:#91B859;"> =</span><span style="color:#F76D47;"> 2</span><span style="color:#90A4AE;font-style:italic;"> # 根据内存大小调整</span></span>
<span class="line"><span style="color:#E2931D;">sidekiq[</span><span style="color:#E2931D;">&#39;concurrency&#39;</span><span style="color:#E2931D;">]</span><span style="color:#91B859;"> =</span><span style="color:#F76D47;"> 10</span><span style="color:#90A4AE;font-style:italic;"> # 默认值25</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h1 id="使用docker安装" tabindex="-1">使用Docker安装 <a class="header-anchor" href="#使用docker安装" aria-label="Permalink to &quot;使用Docker安装&quot;">​</a></h1><h2 id="前提" tabindex="-1">前提 <a class="header-anchor" href="#前提" aria-label="Permalink to &quot;前提&quot;">​</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#90A4AE;font-style:italic;"># 1. 创建一个用于存放配置、日志和数据文件的目录</span></span>
<span class="line"><span style="color:#E2931D;">mkdir</span><span style="color:#91B859;"> /opt/gitlab</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 2. 配置环境变量 $GITLAB_HOME</span></span>
<span class="line"><span style="color:#9C3EDA;">export</span><span style="color:#90A4AE;"> GITLAB_HOME</span><span style="color:#39ADB5;">=</span><span style="color:#90A4AE;">/opt/gitlab</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 永久生效 添加到bashrc或zshrc</span></span>
<span class="line"><span style="color:#6182B8;">echo</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">export GITLAB_HOME=/opt/gitlab</span><span style="color:#39ADB5;">&#39;</span><span style="color:#39ADB5;"> &gt;&gt;</span><span style="color:#91B859;"> ~/.zshrc</span><span style="color:#90A4AE;font-style:italic;"> # ~/.bashrc</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h2><p>官方镜像仓库：<a href="https://hub.docker.com/r/gitlab/gitlab-ce/tags/" target="_blank" rel="noreferrer">https://hub.docker.com/r/gitlab/gitlab-ce/tags/</a></p><p>创建一个 <code>docker-compose.yml</code> 文件：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#90A4AE;font-style:italic;"># docker pull gitlab/gitlab-ce:16.7.7-ce.0</span></span>
<span class="line"><span style="color:#E2931D;">version:</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">16.7.7</span><span style="color:#39ADB5;">&#39;</span></span>
<span class="line"><span style="color:#E2931D;">services:</span></span>
<span class="line"><span style="color:#E2931D;">  gitlab:</span></span>
<span class="line"><span style="color:#E2931D;">    image:</span><span style="color:#91B859;"> gitlab/gitlab-ce:16.7.7-ce.0</span></span>
<span class="line"><span style="color:#E2931D;">    container_name:</span><span style="color:#91B859;"> gitlab</span></span>
<span class="line"><span style="color:#E2931D;">    restart:</span><span style="color:#91B859;"> always</span></span>
<span class="line"><span style="color:#E2931D;">    hostname:</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">gitlab.test.com</span><span style="color:#39ADB5;">&#39;</span></span>
<span class="line"><span style="color:#E2931D;">    environment:</span></span>
<span class="line"><span style="color:#E2931D;">      GITLAB_OMNIBUS_CONFIG:</span><span style="color:#39ADB5;"> |</span></span>
<span class="line"><span style="color:#E2931D;">        external_url</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">http://gitlab.test.com:8888</span><span style="color:#39ADB5;">&#39;</span><span style="color:#90A4AE;font-style:italic;"> # 不能是8080 冲突</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;">        # external_url &#39;https://gitlab.example.com&#39;</span></span>
<span class="line"><span style="color:#E2931D;">    ports:</span></span>
<span class="line"><span style="color:#E2931D;">      -</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">8888:8888</span><span style="color:#39ADB5;">&#39;</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;">     #- &#39;443:443&#39;</span></span>
<span class="line"><span style="color:#E2931D;">      -</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">2222:2222</span><span style="color:#39ADB5;">&#39;</span></span>
<span class="line"><span style="color:#E2931D;">    volumes:</span></span>
<span class="line"><span style="color:#E2931D;">      -</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">$GITLAB_HOME/config:/etc/gitlab</span><span style="color:#39ADB5;">&#39;</span></span>
<span class="line"><span style="color:#E2931D;">      -</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">$GITLAB_HOME/logs:/var/log/gitlab</span><span style="color:#39ADB5;">&#39;</span></span>
<span class="line"><span style="color:#E2931D;">      -</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">$GITLAB_HOME/data:/var/opt/gitlab</span><span style="color:#39ADB5;">&#39;</span></span>
<span class="line"><span style="color:#E2931D;">    shm_size:</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">256m</span><span style="color:#39ADB5;">&#39;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><strong>确保您与 <code>docker-compose.yml</code> 位于同一目录中并启动 GitLab</strong>:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">docker</span><span style="color:#91B859;"> compose</span><span style="color:#91B859;"> up</span><span style="color:#91B859;"> -d</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 访问gitlab.test.com:8888</span></span>
<span class="line"><span style="color:#E2931D;">帐号:root</span></span>
<span class="line"><span style="color:#E2931D;">密码:docker</span><span style="color:#91B859;"> exec</span><span style="color:#91B859;"> -it</span><span style="color:#91B859;"> gitlab</span><span style="color:#91B859;"> grep</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">root</span><span style="color:#39ADB5;">&#39;</span><span style="color:#91B859;"> /etc/gitlab/initial_root_password</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div>`,21),o=[e];function t(r,c,i,b,y,u){return n(),a("div",null,o)}const h=s(p,[["render",t]]);export{d as __pageData,h as default};
