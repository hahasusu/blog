import{_ as s,c as n,o as a,a4 as l}from"./chunks/framework.GYzjcnJh.js";const d=JSON.parse('{"title":"","description":"","frontmatter":{"date":"2024-02-22 03:43:15"},"headers":[],"relativePath":"linux/firewall.md","filePath":"linux/firewall.md"}'),p={name:"linux/firewall.md"},e=l(`<h2 id="linux防火墙" tabindex="-1">Linux防火墙 <a class="header-anchor" href="#linux防火墙" aria-label="Permalink to &quot;Linux防火墙&quot;">​</a></h2><blockquote><p>ConterOS7.0之后使用的是firewall，ConterOS7.0之前使用的是iptables</p></blockquote><h2 id="iptables" tabindex="-1">iptables <a class="header-anchor" href="#iptables" aria-label="Permalink to &quot;iptables&quot;">​</a></h2><blockquote><p>ipatbles命令仅仅是用户空间的linux内核防火墙管理工具，真正的功能实现是由linux内核模块<code>netfilter</code>实现的</p><p>ipatbles命令仅支持ipv4，如果使用的IP协议是ipv6则需要使用专门的管理工具ip6tables。</p></blockquote><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">iptables(选项</span><span style="color:#90A4AE;">)(</span><span style="color:#E2931D;">参数</span><span style="color:#90A4AE;">)</span></span>
<span class="line"><span style="color:#E2931D;">iptables</span><span style="color:#91B859;"> -t</span><span style="color:#91B859;"> 表名</span><span style="color:#39ADB5;"> &lt;</span><span style="color:#91B859;">-A/I/D/</span><span style="color:#90A4AE;">R</span><span style="color:#39ADB5;">&gt;</span><span style="color:#91B859;"> 规则链名</span><span style="color:#90A4AE;"> [规则号] </span><span style="color:#39ADB5;">&lt;</span><span style="color:#90A4AE;">-i/o 网卡名</span><span style="color:#39ADB5;">&gt;</span><span style="color:#90A4AE;"> -p 协议名 </span><span style="color:#39ADB5;">&lt;</span><span style="color:#90A4AE;">-s 源IP/源子网</span><span style="color:#39ADB5;">&gt;</span><span style="color:#90A4AE;"> --sport 源端口 </span><span style="color:#39ADB5;">&lt;</span><span style="color:#90A4AE;">-d 目标IP/目标子网</span><span style="color:#39ADB5;">&gt;</span><span style="color:#90A4AE;"> --dport 目标端口 -j 动作</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>选项</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">-t,</span><span style="color:#91B859;"> --table</span><span style="color:#91B859;"> table</span><span style="color:#91B859;"> 对指定的表</span><span style="color:#91B859;"> table</span><span style="color:#91B859;"> 进行操作，</span><span style="color:#91B859;"> table</span><span style="color:#91B859;"> 必须是</span><span style="color:#91B859;"> raw，</span><span style="color:#91B859;"> nat，filter，mangle</span><span style="color:#91B859;"> 中的一个。如果不指定此选项，默认的是</span><span style="color:#91B859;"> filter</span><span style="color:#91B859;"> 表。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 通用匹配：源地址目标地址的匹配</span></span>
<span class="line"><span style="color:#E2931D;">-p：指定要匹配的数据包协议类型；</span></span>
<span class="line"><span style="color:#E2931D;">-s,</span><span style="color:#91B859;"> --source</span><span style="color:#90A4AE;"> [!] address[/mask] ：把指定的一个／一组地址作为源地址，按此规则进行过滤。当后面没有 mask 时，address 是一个地址，比如：192.168.1.1；当 mask 指定时，可以表示一组范围内的地址，比如：192.168.1.0/255.255.255.0。</span></span>
<span class="line"><span style="color:#E2931D;">-d,</span><span style="color:#91B859;"> --destination</span><span style="color:#90A4AE;"> [!] address[/mask] ：地址格式同上，但这里是指定地址为目的地址，按此进行过滤。</span></span>
<span class="line"><span style="color:#E2931D;">-i,</span><span style="color:#91B859;"> --in-interface</span><span style="color:#90A4AE;"> [!] &lt;网络接口name&gt; ：指定数据包的来自来自网络接口，比如最常见的 eth0 。注意：它只对 INPUT，FORWARD，PREROUTING 这三个链起作用。如果没有指定此选项， 说明可以来自任何一个网络接口。同前面类似，&quot;!&quot; 表示取反。</span></span>
<span class="line"><span style="color:#E2931D;">-o,</span><span style="color:#91B859;"> --out-interface</span><span style="color:#90A4AE;"> [!] &lt;网络接口name&gt; ：指定数据包出去的网络接口。只对 OUTPUT，FORWARD，POSTROUTING 三个链起作用。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 查看管理命令</span></span>
<span class="line"><span style="color:#E2931D;">-L,</span><span style="color:#91B859;"> --list</span><span style="color:#90A4AE;"> [chain] 列出链 chain 上面的所有规则，如果没有指定链，列出表上所有链的所有规则。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 规则管理命令</span></span>
<span class="line"><span style="color:#E2931D;">-A,</span><span style="color:#91B859;"> --append</span><span style="color:#91B859;"> chain</span><span style="color:#91B859;"> rule-specification</span><span style="color:#91B859;"> 在指定链</span><span style="color:#91B859;"> chain</span><span style="color:#91B859;"> 的末尾插入指定的规则，也就是说，这条规则会被放到最后，最后才会被执行。规则是由后面的匹配来指定。</span></span>
<span class="line"><span style="color:#E2931D;">-I,</span><span style="color:#91B859;"> --insert</span><span style="color:#91B859;"> chain</span><span style="color:#90A4AE;"> [rulenum] rule-specification 在链 chain 中的指定位置插入一条或多条规则。如果指定的规则号是1，则在链的头部插入。这也是默认的情况，如果没有指定规则号。</span></span>
<span class="line"><span style="color:#E2931D;">-D,</span><span style="color:#91B859;"> --delete</span><span style="color:#91B859;"> chain</span><span style="color:#91B859;"> rule-specification</span><span style="color:#91B859;"> -D,</span><span style="color:#91B859;"> --delete</span><span style="color:#91B859;"> chain</span><span style="color:#91B859;"> rulenum</span><span style="color:#91B859;"> 在指定的链</span><span style="color:#91B859;"> chain</span><span style="color:#91B859;"> 中删除一个或多个指定规则。</span></span>
<span class="line"><span style="color:#E2931D;">-R</span><span style="color:#91B859;"> num：Replays替换/修改第几条规则</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 链管理命令（这都是立即生效的）</span></span>
<span class="line"><span style="color:#E2931D;">-P,</span><span style="color:#91B859;"> --policy</span><span style="color:#91B859;"> chain</span><span style="color:#91B859;"> target</span><span style="color:#91B859;"> ：为指定的链</span><span style="color:#91B859;"> chain</span><span style="color:#91B859;"> 设置策略</span><span style="color:#91B859;"> target。注意，只有内置的链才允许有策略，用户自定义的是不允许的。</span></span>
<span class="line"><span style="color:#E2931D;">-F,</span><span style="color:#91B859;"> --flush</span><span style="color:#90A4AE;"> [chain] 清空指定链 chain 上面的所有规则。如果没有指定链，清空该表上所有链的所有规则。</span></span>
<span class="line"><span style="color:#E2931D;">-N,</span><span style="color:#91B859;"> --new-chain</span><span style="color:#91B859;"> chain</span><span style="color:#91B859;"> 用指定的名字创建一个新的链。</span></span>
<span class="line"><span style="color:#E2931D;">-X,</span><span style="color:#91B859;"> --delete-chain</span><span style="color:#90A4AE;"> [chain] ：删除指定的链，这个链必须没有被其它任何规则引用，而且这条上必须没有任何规则。如果没有指定链名，则会删除该表中所有非内置的链。</span></span>
<span class="line"><span style="color:#E2931D;">-E,</span><span style="color:#91B859;"> --rename-chain</span><span style="color:#91B859;"> old-chain</span><span style="color:#91B859;"> new-chain</span><span style="color:#91B859;"> ：用指定的新名字去重命名指定的链。这并不会对链内部造成任何影响。</span></span>
<span class="line"><span style="color:#E2931D;">-Z,</span><span style="color:#91B859;"> --zero</span><span style="color:#90A4AE;"> [chain] ：把指定链，或者表中的所有链上的所有计数器清零。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">-j,</span><span style="color:#91B859;"> --jump</span><span style="color:#91B859;"> target</span><span style="color:#39ADB5;"> &lt;</span><span style="color:#91B859;">指定目</span><span style="color:#90A4AE;">标</span><span style="color:#39ADB5;">&gt;</span><span style="color:#91B859;"> ：即满足某条件时该执行什么样的动作。target</span><span style="color:#91B859;"> 可以是内置的目标，比如</span><span style="color:#91B859;"> ACCEPT，也可以是用户自定义的链。</span></span>
<span class="line"><span style="color:#E2931D;">-h：显示帮助信息；</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h3 id="五表五链" tabindex="-1">五表五链 <a class="header-anchor" href="#五表五链" aria-label="Permalink to &quot;五表五链&quot;">​</a></h3><ul><li>五个表名 raw，nat，filter，mangle，security</li><li>五个规则链名 INPUT、OUTPUT、FORWARD、PREROUTING、POSTROUTING</li><li>filter表包含INPUT、OUTPUT、FORWARD三个规则链</li></ul><h3 id="实例" tabindex="-1">实例 <a class="header-anchor" href="#实例" aria-label="Permalink to &quot;实例&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">iptables</span><span style="color:#91B859;"> -A</span><span style="color:#91B859;"> INPUT</span><span style="color:#91B859;"> -s</span><span style="color:#F76D47;"> 127.0.0.1</span><span style="color:#91B859;"> -d</span><span style="color:#F76D47;"> 127.0.0.1</span><span style="color:#91B859;"> -j</span><span style="color:#91B859;"> ACCEPT</span><span style="color:#90A4AE;font-style:italic;">               #允许本地回环接口(即运行本机访问本机)</span></span>
<span class="line"><span style="color:#E2931D;">iptables</span><span style="color:#91B859;"> -A</span><span style="color:#91B859;"> INPUT</span><span style="color:#91B859;"> -m</span><span style="color:#91B859;"> state</span><span style="color:#91B859;"> --state</span><span style="color:#91B859;"> ESTABLISHED,RELATED</span><span style="color:#91B859;"> -j</span><span style="color:#91B859;"> ACCEPT</span><span style="color:#90A4AE;font-style:italic;">    #允许已建立的或相关连的通行</span></span>
<span class="line"><span style="color:#E2931D;">iptables</span><span style="color:#91B859;"> -A</span><span style="color:#91B859;"> OUTPUT</span><span style="color:#91B859;"> -j</span><span style="color:#91B859;"> ACCEPT</span><span style="color:#90A4AE;font-style:italic;">         #允许所有本机向外的访问</span></span>
<span class="line"><span style="color:#E2931D;">iptables</span><span style="color:#91B859;"> -A</span><span style="color:#91B859;"> INPUT</span><span style="color:#91B859;"> -p</span><span style="color:#91B859;"> tcp</span><span style="color:#91B859;"> --dport</span><span style="color:#F76D47;"> 22</span><span style="color:#91B859;"> -j</span><span style="color:#91B859;"> ACCEPT</span><span style="color:#90A4AE;font-style:italic;">    #允许访问22端口</span></span>
<span class="line"><span style="color:#E2931D;">iptables</span><span style="color:#91B859;"> -A</span><span style="color:#91B859;"> INPUT</span><span style="color:#91B859;"> -p</span><span style="color:#91B859;"> tcp</span><span style="color:#91B859;"> --dport</span><span style="color:#F76D47;"> 80</span><span style="color:#91B859;"> -j</span><span style="color:#91B859;"> ACCEPT</span><span style="color:#90A4AE;font-style:italic;">    #允许访问80端口</span></span>
<span class="line"><span style="color:#E2931D;">iptables</span><span style="color:#91B859;"> -A</span><span style="color:#91B859;"> INPUT</span><span style="color:#91B859;"> -p</span><span style="color:#91B859;"> tcp</span><span style="color:#91B859;"> --dport</span><span style="color:#F76D47;"> 21</span><span style="color:#91B859;"> -j</span><span style="color:#91B859;"> ACCEPT</span><span style="color:#90A4AE;font-style:italic;">    #允许ftp服务的21端口</span></span>
<span class="line"><span style="color:#E2931D;">iptables</span><span style="color:#91B859;"> -A</span><span style="color:#91B859;"> INPUT</span><span style="color:#91B859;"> -p</span><span style="color:#91B859;"> tcp</span><span style="color:#91B859;"> --dport</span><span style="color:#F76D47;"> 20</span><span style="color:#91B859;"> -j</span><span style="color:#91B859;"> ACCEPT</span><span style="color:#90A4AE;font-style:italic;">    #允许FTP服务的20端口</span></span>
<span class="line"><span style="color:#E2931D;">iptables</span><span style="color:#91B859;"> -A</span><span style="color:#91B859;"> INPUT</span><span style="color:#91B859;"> -j</span><span style="color:#91B859;"> reject</span><span style="color:#90A4AE;font-style:italic;">       #禁止其他未允许的规则访问</span></span>
<span class="line"><span style="color:#E2931D;">iptables</span><span style="color:#91B859;"> -A</span><span style="color:#91B859;"> FORWARD</span><span style="color:#91B859;"> -j</span><span style="color:#91B859;"> REJECT</span><span style="color:#90A4AE;font-style:italic;">     #禁止其他未允许的规则访问</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 查看已添加的iptables规则</span></span>
<span class="line"><span style="color:#E2931D;">iptables</span><span style="color:#91B859;"> -Lvn</span></span>
<span class="line"><span style="color:#E2931D;">iptables</span><span style="color:#91B859;"> -I</span><span style="color:#91B859;"> INPUT</span><span style="color:#91B859;"> -s</span><span style="color:#F76D47;"> 123.45.6.7</span><span style="color:#91B859;"> -j</span><span style="color:#91B859;"> REJECT</span><span style="color:#90A4AE;font-style:italic;">       #屏蔽单个IP的命令</span></span>
<span class="line"><span style="color:#E2931D;">iptables</span><span style="color:#91B859;"> -I</span><span style="color:#91B859;"> INPUT</span><span style="color:#91B859;"> -s</span><span style="color:#91B859;"> 124.45.0.0/16</span><span style="color:#91B859;"> -j</span><span style="color:#91B859;"> REJECT</span><span style="color:#90A4AE;font-style:italic;">    #封IP段即从123.45.0.1到123.45.255.254的命令</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 删除已添加的iptables规则</span></span>
<span class="line"><span style="color:#E2931D;">iptables</span><span style="color:#91B859;"> -Lvn</span><span style="color:#91B859;"> --line-numbers</span></span>
<span class="line"><span style="color:#E2931D;">iptables</span><span style="color:#91B859;"> -D</span><span style="color:#91B859;"> INPUT</span><span style="color:#91B859;"> number</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="firewalld" tabindex="-1">firewalld <a class="header-anchor" href="#firewalld" aria-label="Permalink to &quot;firewalld&quot;">​</a></h2><p>firewalld的配置方法主要有三种：firewall-config、firewall-cmd和直接编辑xml文件，其中 firewall-config是图形化工具，firewall-cmd是命令行工具</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">systemctl</span><span style="color:#91B859;"> start</span><span style="color:#91B859;">  firewalld</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">更新防火墙规则</span></span>
<span class="line"><span style="color:#E2931D;">firewall-cmd</span><span style="color:#91B859;"> --reload</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">开放端口,修改后需要重启防火墙方可生效</span></span>
<span class="line"><span style="color:#E2931D;">firewall-cmd</span><span style="color:#91B859;"> --zone=public</span><span style="color:#91B859;"> --add-port=8080/tcp</span><span style="color:#91B859;"> --permanent</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">查看开放的端口</span></span>
<span class="line"><span style="color:#E2931D;">firewall-cmd</span><span style="color:#91B859;"> --list-ports</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">关闭端口</span></span>
<span class="line"><span style="color:#E2931D;">firewall-cmd</span><span style="color:#91B859;"> --zone=public</span><span style="color:#91B859;"> --remove-port=8080/tcp</span><span style="color:#91B859;"> --permanent</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 将接口添加到区域，默认接口都在public</span></span>
<span class="line"><span style="color:#E2931D;">firewall-cmd</span><span style="color:#91B859;"> --zone=public</span><span style="color:#91B859;"> --add-interface=eth0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 设置默认接口区域，立即生效无需重启</span></span>
<span class="line"><span style="color:#E2931D;">firewall-cmd</span><span style="color:#91B859;"> --set-default-zone=public</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 显示支持的区域列表</span></span>
<span class="line"><span style="color:#E2931D;">firewall-cmd</span><span style="color:#91B859;"> --get-zones</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 查看防火墙，添加的端口也可以看到</span></span>
<span class="line"><span style="color:#E2931D;">firewall-cmd</span><span style="color:#91B859;"> --list-all</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h2 id="nftables" tabindex="-1">nftables <a class="header-anchor" href="#nftables" aria-label="Permalink to &quot;nftables&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>nftables</code> 是由 Netfilter 开发的，该组织目前维护 iptables。nftables 的创建是为了解决 iptables 的一些性能和扩展问题。</p><p>提供数据包过滤、网络地址转换 (NAT) 和其他数据包管理功能。</p><p>除了新的语法和一些升级以外，nftables 的功能与 iptables 几乎是一样的。之所以推出 nftables 的另一个原因，是因为 iptables 的框架变的有点复杂，iptables, ip6tables, arptables 以及 ebtables 都有不同但相似的功能。</p><p>尽管自 2014 年以来，nftables 就被包含在 Linux 内核中，但随着采用范围的扩大，它最近越来越受欢迎。Linux 世界的变化很慢，过时的实用程序通常需要几年或更长的时间才能逐步淘汰，取而代之的是升级后的实用程序。</p></div><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">dnf</span><span style="color:#91B859;"> install</span><span style="color:#91B859;"> -y</span><span style="color:#91B859;"> nftables</span></span>
<span class="line"><span style="color:#E2931D;">systemctl</span><span style="color:#91B859;"> start</span><span style="color:#91B859;"> nftables</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">nft</span><span style="color:#91B859;"> 操作符</span><span style="color:#91B859;"> 操作目标</span><span style="color:#91B859;"> 操作内容</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">nft</span><span style="color:#91B859;"> add</span><span style="color:#91B859;"> table</span><span style="color:#91B859;"> 族类型</span><span style="color:#91B859;"> 表名</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">nft</span><span style="color:#91B859;"> list</span><span style="color:#91B859;"> ruleset</span><span style="color:#90A4AE;font-style:italic;"> # 列出所有规则</span></span>
<span class="line"><span style="color:#E2931D;">nft</span><span style="color:#91B859;"> list</span><span style="color:#91B859;"> tables</span><span style="color:#90A4AE;font-style:italic;"> # 列出所有表</span></span>
<span class="line"><span style="color:#E2931D;">nft</span><span style="color:#91B859;"> list</span><span style="color:#91B859;"> table</span><span style="color:#91B859;"> filter</span><span style="color:#90A4AE;font-style:italic;"> # 列出表中包含的规则</span></span>
<span class="line"><span style="color:#E2931D;">nft</span><span style="color:#91B859;"> list</span><span style="color:#91B859;"> table</span><span style="color:#91B859;"> inet</span><span style="color:#91B859;"> filter</span><span style="color:#90A4AE;font-style:italic;"> # 列出inet簇的filter表</span></span>
<span class="line"><span style="color:#E2931D;">nft</span><span style="color:#91B859;"> list</span><span style="color:#91B859;"> chain</span><span style="color:#91B859;"> filter</span><span style="color:#91B859;"> input</span><span style="color:#90A4AE;font-style:italic;"> # 列出filter表input链</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 删除所有规则集，使系统没有防火墙</span></span>
<span class="line"><span style="color:#E2931D;">nft</span><span style="color:#91B859;"> flush</span><span style="color:#91B859;"> ruleset</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 删除表中的所有规则</span></span>
<span class="line"><span style="color:#E2931D;">nft</span><span style="color:#91B859;"> flush</span><span style="color:#91B859;"> table</span><span style="color:#91B859;"> filter</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 删除链中的所有规则</span></span>
<span class="line"><span style="color:#E2931D;">nft</span><span style="color:#91B859;"> flush</span><span style="color:#91B859;"> chain</span><span style="color:#91B859;"> filter</span><span style="color:#91B859;"> output</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>nftables包 附带了一个简单而安全的防火墙配置，存储在 /etc/nftables.conf 文件中<br> 可用<code>nft -f /etc/nftables.conf</code> 加载</p><h3 id="表" tabindex="-1">表 <a class="header-anchor" href="#表" aria-label="Permalink to &quot;表&quot;">​</a></h3><p>表包含#链。与 iptables 中的表不同，nftables 中没有内置表。表的数量及其名称由用户决定。不过，每个表只有一个地址族，并且仅适用于该族的数据包。表可以指定五个族之一：</p><table tabindex="0"><thead><tr><th>nftables 族</th><th>iptables 实用程序</th></tr></thead><tbody><tr><td>ip</td><td>iptables</td></tr><tr><td>ip6</td><td>ip6tables</td></tr><tr><td>inet</td><td>iptables 和 ip6tables</td></tr><tr><td>arp</td><td>arptables</td></tr><tr><td>bridge</td><td>ebtables</td></tr></tbody></table><p><code>ip</code>（即 IPv4）是默认族，如果未指定族，则将使用该族。</p><p>要创建同时适用于 IPv4 和 IPv6 的规则，请使用 inet。inet 允许统一 ip 和 ip6 族，从而使同时定义两者的规则更加容易。</p><p>nft 是一个命令行工具，用于在用户空间与 nftables 交互</p><h3 id="链" tabindex="-1">链 <a class="header-anchor" href="#链" aria-label="Permalink to &quot;链&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#90A4AE;font-style:italic;"># 添加基础链的语法</span></span>
<span class="line"><span style="color:#E2931D;">%</span><span style="color:#91B859;"> nft</span><span style="color:#91B859;"> add</span><span style="color:#91B859;"> chain</span><span style="color:#90A4AE;"> [&lt;family&gt;] </span><span style="color:#39ADB5;">&lt;</span><span style="color:#90A4AE;">table_name</span><span style="color:#39ADB5;">&gt;</span><span style="color:#39ADB5;"> &lt;</span><span style="color:#90A4AE;">chain_name</span><span style="color:#39ADB5;">&gt;</span><span style="color:#39ADB5;"> {</span><span style="color:#6182B8;"> type</span><span style="color:#39ADB5;"> &lt;</span><span style="color:#91B859;">typ</span><span style="color:#90A4AE;">e</span><span style="color:#39ADB5;">&gt;</span><span style="color:#91B859;"> hook</span><span style="color:#39ADB5;"> &lt;</span><span style="color:#91B859;">hoo</span><span style="color:#90A4AE;">k</span><span style="color:#39ADB5;">&gt;</span><span style="color:#91B859;"> priority</span><span style="color:#39ADB5;"> &lt;</span><span style="color:#91B859;">valu</span><span style="color:#90A4AE;">e</span><span style="color:#39ADB5;">&gt;</span><span style="color:#90A4AE;"> \\; [policy </span><span style="color:#39ADB5;">&lt;</span><span style="color:#91B859;">polic</span><span style="color:#90A4AE;">y</span><span style="color:#39ADB5;">&gt;</span><span style="color:#90A4AE;"> \\;</span><span style="color:#91B859;">]</span><span style="color:#90A4AE;"> [comment \\&quot;</span><span style="color:#91B859;">text</span><span style="color:#91B859;"> comment</span><span style="color:#90A4AE;">\\&quot; \\;</span><span style="color:#91B859;">]</span><span style="color:#91B859;"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">nft</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">add chain ip foo input { type filter hook input priority 0 ; }</span><span style="color:#39ADB5;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">删除链</span></span>
<span class="line"><span style="color:#E2931D;">nft</span><span style="color:#91B859;"> delete</span><span style="color:#91B859;"> chain</span><span style="color:#90A4AE;"> [family] </span><span style="color:#39ADB5;">&lt;</span><span style="color:#90A4AE;">table_name</span><span style="color:#39ADB5;">&gt;</span><span style="color:#39ADB5;"> &lt;</span><span style="color:#90A4AE;">chain_name</span><span style="color:#39ADB5;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">To</span><span style="color:#91B859;"> flush</span><span style="color:#90A4AE;"> (delete </span><span style="color:#91B859;">all</span><span style="color:#91B859;"> of</span><span style="color:#91B859;"> the</span><span style="color:#91B859;"> rules</span><span style="color:#91B859;"> in</span><span style="color:#90A4AE;">) the chain input of the foo table</span></span>
<span class="line"><span style="color:#E2931D;">nft</span><span style="color:#91B859;"> flush</span><span style="color:#91B859;"> chain</span><span style="color:#91B859;"> foo</span><span style="color:#91B859;"> input</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><strong>type</strong>:</p><ul><li>filter</li><li>route</li><li>nat</li></ul><p><strong>hook</strong>:</p><ul><li>ingress</li><li>prerouting</li><li>input</li><li>output</li><li>forward</li><li>postrouting</li></ul><h3 id="nft脚本" tabindex="-1">nft脚本 <a class="header-anchor" href="#nft脚本" aria-label="Permalink to &quot;nft脚本&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">要创建</span><span style="color:#91B859;"> nftables</span><span style="color:#91B859;"> 脚本，您必须将以下标头添加到脚本文件中</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;">#!/usr/sbin/nft -f</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">add</span><span style="color:#91B859;"> table</span><span style="color:#91B859;"> filter</span></span>
<span class="line"><span style="color:#E2931D;">add</span><span style="color:#91B859;"> chain</span><span style="color:#91B859;"> filter</span><span style="color:#91B859;"> input</span><span style="color:#91B859;"> {</span><span style="color:#91B859;"> type</span><span style="color:#91B859;"> filter</span><span style="color:#91B859;"> hook</span><span style="color:#91B859;"> input</span><span style="color:#91B859;"> priority</span><span style="color:#F76D47;"> 0</span><span style="color:#39ADB5;">;</span><span style="color:#E2931D;"> policy</span><span style="color:#91B859;"> drop</span><span style="color:#39ADB5;">;</span><span style="color:#90A4AE;"> }</span></span>
<span class="line"><span style="color:#E2931D;">add</span><span style="color:#91B859;"> rule</span><span style="color:#91B859;"> filter</span><span style="color:#91B859;"> input</span><span style="color:#91B859;"> ct</span><span style="color:#91B859;"> state</span><span style="color:#91B859;"> established,related</span><span style="color:#91B859;"> counter</span><span style="color:#91B859;"> accept</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># include a single file using the default search path</span></span>
<span class="line"><span style="color:#E2931D;">include</span><span style="color:#39ADB5;"> &quot;</span><span style="color:#91B859;">ipv4-nat.ruleset</span><span style="color:#39ADB5;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># include all files ending in *.nft in the default search path</span></span>
<span class="line"><span style="color:#E2931D;">include</span><span style="color:#39ADB5;"> &quot;</span><span style="color:#91B859;">*.nft</span><span style="color:#39ADB5;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># include all files in a given directory using an absolute path</span></span>
<span class="line"><span style="color:#E2931D;">include</span><span style="color:#39ADB5;"> &quot;</span><span style="color:#91B859;">/etc/nftables/*</span><span style="color:#39ADB5;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 使用define关键字来定义变量</span></span>
<span class="line"><span style="color:#E2931D;">define</span><span style="color:#91B859;"> google_dns</span><span style="color:#91B859;"> =</span><span style="color:#F76D47;"> 8.8.8.8</span></span>
<span class="line"><span style="color:#E2931D;">add</span><span style="color:#91B859;"> rule</span><span style="color:#91B859;"> filter</span><span style="color:#91B859;"> input</span><span style="color:#91B859;"> ip</span><span style="color:#91B859;"> saddr</span><span style="color:#90A4AE;"> $google_dns </span><span style="color:#91B859;">counter</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div>`,32),o=[e];function t(r,c,i,y,b,B){return a(),n("div",null,o)}const m=s(p,[["render",t]]);export{d as __pageData,m as default};
