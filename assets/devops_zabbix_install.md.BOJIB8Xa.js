import{_ as s,c as a,o as n,a4 as l}from"./chunks/framework.GYzjcnJh.js";const d=JSON.parse('{"title":"rocky8 安装 zabbix6.0LTS","description":"","frontmatter":{"date":"2024-02-21 15:30:13"},"headers":[],"relativePath":"devops/zabbix/install.md","filePath":"devops/zabbix/install.md"}'),e={name:"devops/zabbix/install.md"},p=l(`<h1 id="rocky8-安装-zabbix6-0lts" tabindex="-1">rocky8 安装 zabbix6.0LTS <a class="header-anchor" href="#rocky8-安装-zabbix6-0lts" aria-label="Permalink to &quot;rocky8 安装 zabbix6.0LTS&quot;">​</a></h1><h2 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h2><p>官网 <a href="https://www.zabbix.com/download" target="_blank" rel="noreferrer">https://www.zabbix.com/download</a></p><p>中文文档 <a href="https://www.zabbix.com/documentation/current/zh/manual" target="_blank" rel="noreferrer">https://www.zabbix.com/documentation/current/zh/manual</a></p><h2 id="安装zabbix服务端" tabindex="-1">安装zabbix服务端 <a class="header-anchor" href="#安装zabbix服务端" aria-label="Permalink to &quot;安装zabbix服务端&quot;">​</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#90A4AE;font-style:italic;"># 1 安装 Zabbix 存储库</span></span>
<span class="line"><span style="color:#E2931D;">rpm</span><span style="color:#91B859;"> -Uvh</span><span style="color:#91B859;"> https://repo.zabbix.com/zabbix/6.0/rhel/8/x86_64/zabbix-release-6.0-4.el8.noarch.rpm</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># sed -i &#39;s/repo.zabbix.com/mirrors.aliyun.com\\/zabbix/&#39; /etc/yum.repos.d/zabbix.repo</span></span>
<span class="line"><span style="color:#E2931D;">sed</span><span style="color:#91B859;"> -i</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">s/repo.zabbix.com/mirrors.cloud.tencent.com\\/zabbix/</span><span style="color:#39ADB5;">&#39;</span><span style="color:#91B859;"> /etc/yum.repos.d/zabbix.repo</span></span>
<span class="line"><span style="color:#E2931D;">dnf</span><span style="color:#91B859;"> clean</span><span style="color:#91B859;"> all</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># cat &lt;&lt;EOF &gt; /etc/yum.repos.d/zabbix.repo1</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># [zabbix]</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># name=Zabbix Repository - $basearch</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># baseurl=https://mirrors.aliyun.com/zabbix/zabbix/6.0/rhel/8/$basearch/</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># gpgcheck=0</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 2 安装 Zabbix server, frontend, agent</span></span>
<span class="line"><span style="color:#E2931D;">dnf</span><span style="color:#91B859;"> install</span><span style="color:#91B859;"> -y</span><span style="color:#91B859;"> zabbix-server-mysql</span><span style="color:#91B859;"> zabbix-web-mysql</span><span style="color:#91B859;"> zabbix-nginx-conf</span><span style="color:#91B859;"> zabbix-sql-scripts</span><span style="color:#91B859;"> zabbix-selinux-policy</span><span style="color:#91B859;"> zabbix-agent2</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 3 创建初始数据库</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 安装mysql,确保数据库服务器已启动并正在运行。</span></span>
<span class="line"><span style="color:#E2931D;">dnf</span><span style="color:#91B859;"> install</span><span style="color:#91B859;"> -y</span><span style="color:#91B859;"> mysql-server</span></span>
<span class="line"><span style="color:#E2931D;">systemctl</span><span style="color:#91B859;"> enable</span><span style="color:#91B859;"> --now</span><span style="color:#91B859;"> mysqld</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># mysql -uroot -p password</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># mysql</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">cat</span><span style="color:#39ADB5;"> &lt;&lt;</span><span style="color:#39ADB5;"> EOF</span><span style="color:#39ADB5;"> |</span><span style="color:#E2931D;"> mysql</span></span>
<span class="line"><span style="color:#91B859;">create database zabbix character set utf8mb4 collate utf8mb4_bin;</span></span>
<span class="line"><span style="color:#91B859;">create user zabbix@localhost identified by &#39;luozaibo&#39;;</span></span>
<span class="line"><span style="color:#91B859;">grant all privileges on zabbix.* to zabbix@localhost;</span></span>
<span class="line"><span style="color:#91B859;">set global log_bin_trust_function_creators = 1;</span></span>
<span class="line"><span style="color:#39ADB5;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 4 在 Zabbix 服务器主机上导入初始架构和数据</span></span>
<span class="line"><span style="color:#E2931D;">zcat</span><span style="color:#91B859;"> /usr/share/zabbix-sql-scripts/mysql/server.sql.gz</span><span style="color:#39ADB5;"> |</span><span style="color:#E2931D;"> mysql</span><span style="color:#91B859;"> --default-character-set=utf8mb4</span><span style="color:#91B859;"> -uzabbix</span><span style="color:#91B859;"> -pluozaibo</span><span style="color:#91B859;"> zabbix</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 导入数据库模式后禁用 log_bin_trust_function_creators 选项</span></span>
<span class="line"><span style="color:#E2931D;">cat</span><span style="color:#39ADB5;"> &lt;&lt;</span><span style="color:#39ADB5;"> EOF</span><span style="color:#39ADB5;"> |</span><span style="color:#E2931D;"> mysql</span></span>
<span class="line"><span style="color:#91B859;">set global log_bin_trust_function_creators = 0;</span></span>
<span class="line"><span style="color:#39ADB5;">EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 5 为Zabbix服务器配置数据库</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># vim /etc/zabbix/zabbix_server.conf</span></span>
<span class="line"><span style="color:#E2931D;">sed</span><span style="color:#91B859;"> -i</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">/# DBPassword/a DBPassword=luozaibo</span><span style="color:#39ADB5;">&#39;</span><span style="color:#91B859;"> /etc/zabbix/zabbix_server.conf</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># DBPassword=password</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 6 编辑文件 /etc/nginx/conf.d/zabbix.conf 取消注释并设置“listen”和“server_name”指令。</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># listen 8080;</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># server_name test.com;</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># test.com为服务器ip地址，需要DNS解析</span></span>
<span class="line"><span style="color:#E2931D;">sed</span><span style="color:#91B859;"> -i</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">1a\\        listen          8080;\\n        server_name     test.com;</span><span style="color:#39ADB5;">&#39;</span><span style="color:#91B859;"> /etc/nginx/conf.d/zabbix.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 7 启动 Zabbix 服务器</span></span>
<span class="line"><span style="color:#E2931D;">systemctl</span><span style="color:#91B859;"> enable</span><span style="color:#91B859;"> --now</span><span style="color:#91B859;"> zabbix-server</span><span style="color:#91B859;"> zabbix-agent2</span><span style="color:#91B859;"> nginx</span><span style="color:#91B859;"> php-fpm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 8 打开 test.com:8080 </span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 默认用户名 Admin</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 默认密码 zabbix</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h2 id="安装zabbix-agent2客户端" tabindex="-1">安装zabbix-agent2客户端 <a class="header-anchor" href="#安装zabbix-agent2客户端" aria-label="Permalink to &quot;安装zabbix-agent2客户端&quot;">​</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#90A4AE;font-style:italic;"># 1 安装 Zabbix 存储库</span></span>
<span class="line"><span style="color:#E2931D;">rpm</span><span style="color:#91B859;"> -Uvh</span><span style="color:#91B859;"> https://repo.zabbix.com/zabbix/6.0/rhel/8/x86_64/zabbix-release-6.0-4.el8.noarch.rpm</span></span>
<span class="line"><span style="color:#E2931D;">sed</span><span style="color:#91B859;"> -i</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">s/repo.zabbix.com/mirrors.aliyun.com\\/zabbix/</span><span style="color:#39ADB5;">&#39;</span><span style="color:#91B859;"> /etc/yum.repos.d/zabbix.repo</span></span>
<span class="line"><span style="color:#E2931D;">dnf</span><span style="color:#91B859;"> clean</span><span style="color:#91B859;"> all</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 2 安装Zabbix agent2</span></span>
<span class="line"><span style="color:#E2931D;">dnf</span><span style="color:#91B859;"> install</span><span style="color:#91B859;"> -y</span><span style="color:#91B859;"> zabbix-agent2</span><span style="color:#91B859;"> zabbix-agent2-plugin-</span><span style="color:#90A4AE;">*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 3 修改配置</span></span>
<span class="line"><span style="color:#90A4AE;">Hostname</span><span style="color:#39ADB5;">=</span><span style="color:#91B859;">zbx-agent2</span></span>
<span class="line"><span style="color:#90A4AE;">Server</span><span style="color:#39ADB5;">=</span><span style="color:#91B859;">192.168.2.15</span></span>
<span class="line"><span style="color:#E2931D;">sed</span><span style="color:#91B859;"> -i</span><span style="color:#39ADB5;"> &quot;</span><span style="color:#91B859;">s/127.0.0.1$/</span><span style="color:#90A4AE;">$Server</span><span style="color:#91B859;">/</span><span style="color:#39ADB5;">&quot;</span><span style="color:#91B859;"> /etc/zabbix/zabbix_agent2.conf</span></span>
<span class="line"><span style="color:#E2931D;">sed</span><span style="color:#91B859;"> -ri</span><span style="color:#39ADB5;"> &quot;</span><span style="color:#91B859;">s/(^Hostname=).*/\\1</span><span style="color:#90A4AE;">$Hostname</span><span style="color:#91B859;">/</span><span style="color:#39ADB5;">&quot;</span><span style="color:#91B859;"> /etc/zabbix/zabbix_agent2.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 4 启动Zabbix agent2进程</span></span>
<span class="line"><span style="color:#E2931D;">systemctl</span><span style="color:#91B859;"> enable</span><span style="color:#91B859;"> --now</span><span style="color:#91B859;"> zabbix-agent2</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># systemctl restart zabbix-agent2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="验证zabbix-agent2的连通性" tabindex="-1">验证zabbix-agent2的连通性 <a class="header-anchor" href="#验证zabbix-agent2的连通性" aria-label="Permalink to &quot;验证zabbix-agent2的连通性&quot;">​</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#90A4AE;font-style:italic;"># 1 在服务端安装zabbix-get,通过命令 主动获取客户端的的数据</span></span>
<span class="line"><span style="color:#E2931D;">dnf</span><span style="color:#91B859;"> install</span><span style="color:#91B859;"> -y</span><span style="color:#91B859;"> zabbix-get</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 返回1 表示成功</span></span>
<span class="line"><span style="color:#E2931D;">zabbix_get</span><span style="color:#91B859;"> -s</span><span style="color:#91B859;"> agent2_ip</span><span style="color:#91B859;"> -p</span><span style="color:#F76D47;"> 10050</span><span style="color:#91B859;"> -k</span><span style="color:#91B859;"> agent.ping</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="图形乱码" tabindex="-1">图形乱码 <a class="header-anchor" href="#图形乱码" aria-label="Permalink to &quot;图形乱码&quot;">​</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">dnf</span><span style="color:#91B859;"> install</span><span style="color:#91B859;"> -y</span><span style="color:#91B859;"> wqy-microhei-fonts</span></span>
<span class="line"><span style="color:#E2931D;">cp</span><span style="color:#91B859;"> /usr/share/fonts/wqy-microhei/wqy-microhei.ttc</span><span style="color:#91B859;"> /usr/share/fonts/dejavu/DejaVuSans.ttf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div>`,12),o=[p];function r(t,c,i,b,y,m){return n(),a("div",null,o)}const B=s(e,[["render",r]]);export{d as __pageData,B as default};
