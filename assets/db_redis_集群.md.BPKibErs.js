import{_ as s,c as a,o as n,a4 as e}from"./chunks/framework.GYzjcnJh.js";const m=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"db/redis/集群.md","filePath":"backend/db/redis/集群.md"}'),l={name:"db/redis/集群.md"},p=e(`<h2 id="redis-cluster-介绍" tabindex="-1">Redis Cluster 介绍 <a class="header-anchor" href="#redis-cluster-介绍" aria-label="Permalink to &quot;Redis Cluster 介绍&quot;">​</a></h2><p>使用哨兵sentinel 只能解决Redis高可用问题，实现Redis的自动故障转移,但仍然无法解决Redis Master单节点的性能瓶颈问题</p><p>为了解决单机性能的瓶颈，提高Redis 服务整体性能，可以使用分布式集群的解决方案</p><p>Redis cluster 需要至少 3个master节点才能实现,slave节点数量不限,当然一般每个master都至少对应的有一个slave节点</p><p>如果有三个主节点采用哈希槽 hash slot 的方式来分配16384个槽位 slot</p><p>此三个节点分别承担的slot 区间可以是如以下方式分配</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">节点M1</span><span style="color:#91B859;"> 0－5460</span></span>
<span class="line"><span style="color:#E2931D;">节点M2</span><span style="color:#91B859;"> 5461－10922</span></span>
<span class="line"><span style="color:#E2931D;">节点M3</span><span style="color:#91B859;"> 10923－16383</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>创建 redis cluster集群的环境准备</strong></p><ul><li>每个Redis 节点采用相同的相同的Redis版本、相同的密码、硬件配置</li><li>所有Redis服务器必须没有任何数据</li></ul><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#90A4AE;font-style:italic;">#手动修改配置文件 vim /etc/redis.conf</span></span>
<span class="line"><span style="color:#E2931D;">bind</span><span style="color:#F76D47;"> 0.0.0.0</span></span>
<span class="line"><span style="color:#E2931D;">masterauth</span><span style="color:#F76D47;"> 123456</span><span style="color:#90A4AE;font-style:italic;"> #建议配置，否则后期的master和slave主从复制无法成功，还需再配置</span></span>
<span class="line"><span style="color:#E2931D;">requirepass</span><span style="color:#F76D47;"> 123456</span></span>
<span class="line"><span style="color:#E2931D;">cluster-enabled</span><span style="color:#91B859;"> yes</span><span style="color:#90A4AE;font-style:italic;"> #取消此行注释,必须开启集群，开启后 redis 进程会有cluster标识</span></span>
<span class="line"><span style="color:#E2931D;">cluster-config-file</span><span style="color:#91B859;"> nodes-6379.conf</span><span style="color:#90A4AE;font-style:italic;"> #取消此行注释,此为集群状态数据文件,记录主从关系及slot范围信息,由redis cluster 集群自动创建和维护</span></span>
<span class="line"><span style="color:#E2931D;">cluster-require-full-coverage</span><span style="color:#91B859;"> no</span><span style="color:#90A4AE;font-style:italic;"> #默认值为yes,设为no可以防止一个节点不可用导致整个cluster不可用</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>创建集群</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#90A4AE;font-style:italic;"># --cluster-replicas 1 表示每个master对应一个slave节点</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">redis-cli</span><span style="color:#91B859;"> -a</span><span style="color:#F76D47;"> 123456</span><span style="color:#91B859;"> --cluster</span><span style="color:#91B859;"> create</span><span style="color:#90A4AE;"> \\</span></span>
<span class="line"><span style="color:#90A4AE;">10.0.0.8:6379 </span><span style="color:#91B859;">10.0.0.18:6379</span><span style="color:#91B859;"> 10.0.0.28:6379</span><span style="color:#90A4AE;"> \\</span></span>
<span class="line"><span style="color:#90A4AE;">10.0.0.38:6379 </span><span style="color:#91B859;">10.0.0.48:6379</span><span style="color:#91B859;"> 10.0.0.58:6379</span><span style="color:#90A4AE;"> \\</span></span>
<span class="line"><span style="color:#90A4AE;">--cluster-replicas </span><span style="color:#F76D47;">1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><strong>查看状态</strong></p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">redis-cli</span><span style="color:#91B859;"> -a</span><span style="color:#F76D47;"> 123456</span><span style="color:#91B859;"> CLUSTER</span><span style="color:#91B859;"> INFO</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 查看对应关系</span></span>
<span class="line"><span style="color:#E2931D;">redis-cli</span><span style="color:#91B859;"> -a</span><span style="color:#F76D47;"> 123456</span><span style="color:#91B859;"> CLUSTER</span><span style="color:#91B859;"> NODES</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div>`,14),r=[p];function o(t,c,i,d,b,u){return n(),a("div",null,r)}const h=s(l,[["render",o]]);export{m as __pageData,h as default};
