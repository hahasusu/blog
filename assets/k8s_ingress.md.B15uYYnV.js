import{_ as s,c as n,o as a,a4 as e}from"./chunks/framework.GYzjcnJh.js";const d=JSON.parse('{"title":"组件介绍","description":"","frontmatter":{},"headers":[],"relativePath":"k8s/ingress.md","filePath":"k8s/ingress.md"}'),l={name:"k8s/ingress.md"},r=e(`<h1 id="组件介绍" tabindex="-1">组件介绍 <a class="header-anchor" href="#组件介绍" aria-label="Permalink to &quot;组件介绍&quot;">​</a></h1><h2 id="" tabindex="-1"><a class="header-anchor" href="#" aria-label="Permalink to &quot;&quot;">​</a></h2><h2 id="ingress基本概念" tabindex="-1">Ingress基本概念 <a class="header-anchor" href="#ingress基本概念" aria-label="Permalink to &quot;Ingress基本概念&quot;">​</a></h2><blockquote><p>在Kubernetes集群中，Ingress作为集群内服务对外暴露的访问接入点，几乎承载着集群内服务访问的所有流量。</p><p>Ingress是Kubernetes中的一个资源对象，用来管理集群外部访问集群内部服务的方式。</p><p>您可以通过Ingress资源来配置不同的转发规则，从而实现根据不同的规则设置访问集群内不同的Service所对应的后端Pod。</p></blockquote><h2 id="nginx-ingress-controller工作原理" tabindex="-1">Nginx Ingress Controller工作原理 <a class="header-anchor" href="#nginx-ingress-controller工作原理" aria-label="Permalink to &quot;Nginx Ingress Controller工作原理&quot;">​</a></h2><p>为了使得Nginx Ingress资源正常工作，集群中必须要有一个Nginx Ingress Controller来解析Nginx Ingress的转发规则。</p><p>Nginx Ingress Controller收到请求，匹配Nginx Ingress转发规则转发到后端Service所对应的Pod，由Pod处理请求。</p><p>Kubernetes中的Service、Nginx Ingress与Nginx Ingress Controller有着以下关系:</p><ul><li>Service是后端真实服务的抽象，一个Service可以代表多个相同的后端服务。</li><li>Nginx Ingress是反向代理规则，用来规定HTTP/HTTPS请求应该被转发到哪个Service所对应的Pod上。例如根据请求中不同的Host和URL路径，让请求落到不同的Service所对应的Pod上。</li><li>Nginx Ingress Controller是Kubernetes集群中的一个组件，负责解析Nginx Ingress的反向代理规则。如果Nginx Ingress有增删改的变动，Nginx Ingress Controller会及时更新自己相应的转发规则，当Nginx Ingress Controller收到请求后就会根据这些规则将请求转发到对应Service的Pod上。</li></ul><p><img src="http://pic.justdoiit.top/imgs/2024-03-17-1710665251.webp" alt="" loading="lazy"></p><p><img src="http://pic.justdoiit.top/imgs/2024-03-17-1710665367.webp" alt="" loading="lazy"></p><h2 id="ingress-nginx" tabindex="-1">ingress-nginx <a class="header-anchor" href="#ingress-nginx" aria-label="Permalink to &quot;ingress-nginx&quot;">​</a></h2><p><a href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noreferrer">github主页</a></p><p><a href="https://github.com/kubernetes/ingress-nginx?tab=readme-ov-file#supported-versions-table" target="_blank" rel="noreferrer">版本之间的支持</a></p><p><a href="https://kubernetes.github.io/ingress-nginx/deploy/#quick-start" target="_blank" rel="noreferrer">ingress-nginx文档</a></p><h2 id="使用" tabindex="-1">使用 <a class="header-anchor" href="#使用" aria-label="Permalink to &quot;使用&quot;">​</a></h2><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-lighter vp-code" tabindex="0"><code><span class="line"><span style="color:#E2931D;">kubectl</span><span style="color:#91B859;"> apply</span><span style="color:#91B859;"> -f</span><span style="color:#91B859;"> https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.10.0/deploy/static/provider/cloud/deploy.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">wget</span><span style="color:#91B859;"> https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.10.0/deploy/static/provider/cloud/deploy.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 获取镜像</span></span>
<span class="line"><span style="color:#E2931D;">grep</span><span style="color:#91B859;"> -Eo</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">registry.*</span><span style="color:#39ADB5;">&#39;</span><span style="color:#91B859;"> deploy.yaml</span><span style="color:#39ADB5;"> |</span><span style="color:#E2931D;"> cut</span><span style="color:#91B859;"> -d@</span><span style="color:#91B859;"> -f1</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># registry.k8s.io/ingress-nginx/controller:v1.10.1</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.4.1</span></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># registry.k8s.io/ingress-nginx/kube-webhook-certgen:v1.4.1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># pull</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># tag</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># push to harbor</span></span>
<span class="line"></span>
<span class="line"><span style="color:#90A4AE;font-style:italic;"># 修改文件中镜像地址</span></span>
<span class="line"><span style="color:#E2931D;">sed</span><span style="color:#91B859;"> -ri</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">s#registry.*(controller.*)@.*#10.0.0.40/library/\\1#g</span><span style="color:#39ADB5;">&#39;</span><span style="color:#91B859;"> deploy.yaml</span></span>
<span class="line"><span style="color:#E2931D;">sed</span><span style="color:#91B859;"> -ri</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">s#registry.*(kube.*)@.*#10.0.0.40/library/\\1#g</span><span style="color:#39ADB5;">&#39;</span><span style="color:#91B859;"> deploy.yaml</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E2931D;">sed</span><span style="color:#91B859;"> -ri</span><span style="color:#39ADB5;"> &#39;</span><span style="color:#91B859;">s/Local$/Cluster/</span><span style="color:#39ADB5;">&#39;</span><span style="color:#91B859;"> deploy.yaml</span></span>
<span class="line"><span style="color:#E2931D;">sed</span><span style="color:#91B859;"> -i</span><span style="color:#39ADB5;"> &quot;</span><span style="color:#91B859;">/externalTraffic/a\\  externalIPs: [&#39;10.0.0.100&#39;]</span><span style="color:#39ADB5;">&quot;</span><span style="color:#91B859;"> deploy.yaml</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div>`,17),p=[r];function o(t,i,c,g,b,y){return a(),n("div",null,p)}const h=s(l,[["render",o]]);export{d as __pageData,h as default};
